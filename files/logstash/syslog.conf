# Syslog kaynakları:
# - RFC3164: 5514/udp ve 5514/tcp
# - RFC5424: 5515/tcp
input {
  udp { port => 5514 }
  tcp { port => 5514 }
  tcp { port => 5515 codec => plain {} } # RFC5424 gönderen bazı cihazlar için ayrı portta
}

filter {
  mutate {
    add_tag => ["syslog"]
    add_field => { "[event][module]" => "syslog" }
    add_field => { "[event][dataset]" => "syslog" }
  }

  # syslog plugin kullanılmadan basit grok (genel/gevşek)
  grok {
    match => { "message" => [
      "<%{NONNEGINT:syslog.pri}>%{SYSLOGTIMESTAMP:syslog.timestamp} %{HOSTNAME:host.name} %{DATA:syslog.program}(?:\\[%{POSINT:process.pid}\\])?: %{GREEDYDATA:syslog.msg}",
      "%{SYSLOGTIMESTAMP:syslog.timestamp} %{HOSTNAME:host.name} %{DATA:syslog.program}(?:\\[%{POSINT:process.pid}\\])?: %{GREEDYDATA:syslog.msg}"
    ] }
    tag_on_failure => ["_syslog_grok_fail"]
  }

  date {
    match => ["syslog.timestamp", "MMM  d HH:mm:ss", "MMM dd HH:mm:ss", "ISO8601"]
    target => "@timestamp"
    remove_field => ["syslog.timestamp"]
  }
}

output {
  elasticsearch {
    hosts => ["https://localhost:9200"]
    ssl => true
    cacert => "/etc/logstash/certs/ca.crt"
    user => "logstash_ingest"
    password => "${ES_PW}"
    data_stream => true
    data_stream_type => "logs"
    data_stream_dataset => "syslog"
    data_stream_namespace => "default"
  }
}