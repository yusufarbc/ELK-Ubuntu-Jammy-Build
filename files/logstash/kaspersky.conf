# Kaspersky Security Center / Endpoint — Syslog veya UDP/ TCP 5516
# (KSC'de syslog export açıldığında bu porta yönlendirin)
input {
  udp { port => 5516 type => "kaspersky" }
  tcp { port => 5516 type => "kaspersky" }
}

filter {
  if [type] == "kaspersky" {
    mutate {
      add_tag   => ["kaspersky"]
      add_field => { "[event][module]"  => "kaspersky" }
      add_field => { "[event][dataset]" => "kaspersky" }
    }
    # Örnek basit ayrıştırma (değiştirilebilir)
    grok {
      match => {
        "message" => [
          "%{TIMESTAMP_ISO8601:@timestamp}\s+%{WORD:severity}\s+%{HOSTNAME:host}\s+%{DATA:app}\s+%{GREEDYDATA:msg}"
        ]
      }
      tag_on_failure => ["_kas_grok_fail"]
    }
  }
}

output {
  elasticsearch {
    hosts    => ["https://localhost:9200"]
    index    => "logs-kaspersky-default"
    user     => "logstash_ingest"
    password => "${ES_PW}"
    ssl      => true
    cacert   => "/etc/logstash/certs/ca.crt"
  }
}