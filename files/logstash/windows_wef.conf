# WEF/WEC → Winlogbeat (yalnız WEC'e kurulu) → Logstash 5045/tcp
input {
  beats {
    port => 5045
  }
}

filter {
  if [agent][type] == "winlogbeat" {
    mutate {
      add_tag   => ["wef","windows"]
      add_field => { "[event][module]"  => "windows" }
      add_field => { "[event][dataset]" => "windows" }
      # NOT: ECS'de event.code string (keyword) olması önerilir; integer'a çevirmiyoruz.
      copy => {
        "[winlog][computer_name]" => "[host][name]"
        "[winlog][channel]"       => "[log][file][path]"
        "[winlog][provider_name]" => "[event][provider]"
      }
    }

    if [winlog][time_created] {
      date { match => ["[winlog][time_created]", "ISO8601"] target => "@timestamp" }
    }

    # Basit event.code -> event.action eşlemesi (inline sözlük, DOĞRU söz dizimi)
    translate {
      field       => "[event][code]"
      destination => "[event][action]"
      dictionary  => {
        "4624" => "logon_success"
        "4625" => "logon_fail"
        "4634" => "logoff"
        "4648" => "logon_explicit"
      }
      exact       => true
      override    => true
      fallback    => "other"
    }

    # Eğer event.code'un numerik hali de lazım olursa ayrı bir alana çevir:
    # mutate { convert => { "[event][code_num]" => "integer" } }  # önce [event][code_num] kopyalamayı eklemen gerekir
  }
}

output {
  elasticsearch {
    hosts                  => ["https://localhost:9200"]
    ssl                    => true
    cacert                 => "/etc/logstash/certs/ca.crt"
    user                   => "logstash_ingest"
    password               => "${ES_PW}"
    data_stream            => true
    data_stream_type       => "logs"
    data_stream_dataset    => "windows"
    data_stream_namespace  => "default"
  }
}